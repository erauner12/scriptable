// Variables used by Scriptable.
// These must be at the very top of the file. Do not edit.
// icon-color: pink; icon-glyph: book-open;
const e=e=>Number.isFinite(e),t=e=>"string"==typeof e||e instanceof String,n=Boolean,r=e=>"function"==typeof e,a=e=>{return null===e?"null":Array.isArray(e)?"array":(n=e)instanceof Date||"[object Date]"===Object.prototype.toString.call(n)?"date":t(e)?"string":(e=>e instanceof RegExp||"[object RegExp]"===Object.prototype.toString.call(e))(e)?"regexp":e instanceof Map?"map":e instanceof Set?"set":typeof e;var n},o=(e,t,n)=>Math.min(Math.max(e,t),n),i=e=>{const t=o(Math.round(e),0,255).toString(16);return(t.length<2?"0":"")+t},s=(e,t)=>{const{hex:n}=e,r=Number.parseInt(n.slice(0,2),16),a=Number.parseInt(n.slice(2,4),16),o=Number.parseInt(n.slice(4,6),16);return new Color([r,a,o].map(t<0?e=>i((1+t)*e):e=>i((1-t)*e+255*t)).join(""))},l=(e,t=.4)=>s(e,t<0?t:-1*t),c=(e,t=.4)=>s(e,t<0?-1*t:t),d=(e,t=.4)=>(Device.isUsingDarkAppearance()?l:c)(e,t);class u extends Error{payload;constructor(e,t){super(e),this.payload=t}}const h=(e,t,n)=>{const r=e[t];if(void 0===r){const r=`Array lookup failed in "${n}", no value at index ${t}`;throw console.error(r),new u(r,{arr:e})}return r},p=e=>Object.fromEntries(e),g=e=>{const t=Object.keys(e);return{segmentKeys:t,unmatchedRuleKeys:t.filter((t=>"UNMATCHED"===e[t])),seed:p(t.map((e=>[e,[]])))}},m=(e,t)=>e.reduce((e=>{const{segmentKeys:t,unmatchedRuleKeys:n}=g(e);return(a,o)=>{const i=t.filter((t=>{const n=e[t];return!!r(n)&&n(o)}));if(i.length>0)for(const e of i)a[e].push(o);else if(n.length>0)for(const e of n)a[e].push(o);return a}})(t),g(t).seed),f=(...e)=>t=>e.reduceRight(((e,t)=>t(e)),t),w=e=>t=>(n,r,a)=>t(n,e(r,a),a),b=(e,t)=>[...e,...Array.isArray(t)?t:[t]],y=(e,t)=>e.reduce(t(b),[]),C=(e,t)=>{const n=a(e);if(n!==a(t))return!1;if("date"===n)return JSON.stringify(e)===JSON.stringify(t);if(!["object","array"].includes(n))return e===t;if("object"==typeof e&&"object"==typeof t&&null!==e&&null!==t||Array.isArray(e)&&Array.isArray(t)){const n=D(e),r=D(t);return n.length===r.length&&n.every((n=>C(e[n],t[n])))}return!1},S=(e,t)=>p(T(e).filter((([e])=>t.includes(e)))),v=(e,t)=>[...Array.from({length:t-e+1}).keys()].map((t=>t+e)),T=e=>Object.entries(e),D=e=>Object.keys(e),E=(e,t)=>t in e,_=(e,t)=>e===t.length-1,k=e=>e.at(-1),x=e=>e.reduce(((e,t)=>e+t),0),O=(e,t)=>{const n=e.length<t.length,r=new Set(n?e:t);return(n?t:e).filter((e=>r.has(e)))},F=(e,t,n=((e,t)=>e===t))=>e.filter((e=>!t.some((t=>n(e,t))))),I=(e,t)=>e.filter((e=>e!==t)),R=(e,t,n)=>{const r=e.includes(t);return!0===n?r?e:[...e,t]:!1===n?r?I(e,t):e:r?I(e,t):[...e,t]},M=(e,r)=>{const a=e.filter(n);return t(r)?a.join(r):a},P=(e,t,n)=>{const r=t[e];(e=>void 0!==e)(r)&&(n[e]=r)},A=(e,t)=>{((e,t=[])=>{const n=new Notification;for(const t of D(e))P(t,e,n);for(const{title:e,url:r,destructive:a=!1}of t)n.addAction(e,r,a);return n})({title:e,body:t}).schedule()},B=(...e)=>t=>e.reduce(((e,t)=>t(e)),t),L=B,$=(e,t,n=((e,t)=>e===t))=>{const r=t.findIndex((t=>n(t,e)));if(-1===r)return console.warn(`Current value ${String(e)} not found in cycle options, returning first option`),h(t,0,"cycle.1");const a=r===t.length-1;return h(t,a?0:r+1,"cycle.2")},N=()=>{};class q{label;isDynamic;colorObj;constructor({label:e,lightColor:t,darkColor:n,staticColor:r}){if(this.label=e,this.isDynamic=Boolean(t&&n),!r&&!this.isDynamic)throw new Error(`Color ${e}: must provide more color data`);this.colorObj={light:t,dark:n,static:r}}get color(){return this.isDynamic?Color.dynamic(this.lightColor,this.colorObj.dark):this.colorObj.static}get lightColor(){return this.colorObj.light||this.colorObj.static}get darkColor(){return this.colorObj.dark||this.colorObj.static}}const H=([e])=>new Color(e),V=e=>e instanceof q,U={white:H`ffffff`,black:H`000000`,grayMinus3:H`fdfdfd`,grayMinus2:H`fcfcfc`,grayMinus1:H`fbfbfb`,gray0:H`efefef`,gray1:H`d8d8d8`,gray2:H`c2c2c2`,gray3:H`adadad`,gray4:H`979797`,gray5:H`6c6c6c`,gray6:H`414141`,gray7:H`2b2b2b`,gray8:H`161616`,red_l4:H`e3949e`,red_l3:H`da717e`,red_l2:H`d14d5e`,red_l1:H`c33245`,red:H`a12a3a`,red_d1:H`82212e`,red_d2:H`611923`,yellow_l3:H`eae5d6`,yellow_l2:H`ddd4bb`,yellow_l1:H`cfc3a0`,yellow:H`bcab79`,yellow_d1:H`b4a16a`,yellow_d2:H`a38f52`,dark_green_l2:H`4f6769`,dark_green_l1:H`3d5051`,dark_green:H`253031`,dark_green_d1:H`1a2223`,dark_green_d2:H`121717`,green_l4:H`96babd`,green_l3:H`73a3a7`,green_l2:H`508c91`,green_l1:H`417376`,green:H`315659`,green_d1:H`244042`,green_d2:H`162627`,deep_blue_l2:H`4da5d1`,deep_blue_l1:H`3292c3`,deep_blue:H`2978a0`,deep_blue_d1:H`216282`,deep_blue_d2:H`194961`,blue_l1:H`ebf4ff`,blue:H`c6e0ff`,blue_d1:H`add2ff`,blue_d2:H`85bcff`,umber:H`695958`,black_coffee:H`41393e`,alice_blue:H`e4f0ff`,black_coral:H`4b5463`,platinum:H`e6e8e9`,majorelle_blue:H`4f46e5`,neon_blue:H`6366f1`,magnolia:H`f2f1fd`,ocean_blue:H`4339ca`,slate_100:H`f1f5f9`,slate_700:H`334155`,sky_500:H`0ea5e9`,red_500:H`ef4444`,caribbean_green:H`00d1b2`,jasmine:H`ffe08a`,field_drab:H`574a2b`},j={domain_personal:U.sky_500,domain_work:U.red_500,danger:U.red_500,success:U.caribbean_green,warning:U.jasmine,bg:new q({label:"bg",lightColor:U.white,darkColor:H`1c1c1e`}),primaryTextColor:new q({label:"primaryTextColor",lightColor:U.gray8,darkColor:U.gray1}),secondaryTextColor:new q({label:"secondaryTextColor",lightColor:U.gray5,darkColor:U.gray4}),hr:new q({label:"hr",lightColor:U.gray0,darkColor:U.gray7}),selectedBgColor:new q({label:"selectedBgColor",lightColor:U.gray1,darkColor:U.gray6})},W=[...D(U),...D(j)],z=e=>{if(E(U,e))return U[e];if(E(j,e))return j[e];throw new Error(`No color found for key ${String(e)}`)},K=e=>{const t=z(e);return V(t)?t.color:t},Y=(e,n)=>{const r=t(e)?K(e):e,a=t(n)?K(n):n;return Color.dynamic(r,a)},G=()=>p(W.map((e=>[e,K(e)]))),J=e=>{if(6!==e.length)throw new Error("Must be 6 chars");const[t,n,r]=((e,t)=>{let n=[];for(const r of e){const e=k(n);e?n=e.length===t?[...n,[r]]:[...n.slice(0,-1),[...e,r]]:n=[[r]]}return n})([...e],2);return{r:t.join(""),g:n.join(""),b:r.join("")}},Q=({r:e,g:t,b:n})=>({r:Number.parseInt(e,16),g:Number.parseInt(t,16),b:Number.parseInt(n,16)}),X=e=>Math.round(e).toString(16).padStart(2,"0"),Z=e=>t(e)?e:e.hex,ee=({from:e,to:t,numPoints:n})=>{const r=Q(J(Z(e))),a=Q(J(Z(t))),o=1/(n+1);return v(1,n).map((e=>({r:r.r+o*e*(a.r-r.r),g:r.g+o*e*(a.g-r.g),b:r.b+o*e*(a.b-r.b)}))).map((({r:e,g:t,b:n})=>(({r:e,g:t,b:n})=>new Color([e,t,n].join("")))({r:X(Math.floor(e)),g:X(Math.floor(t)),b:X(Math.floor(n))})))};let te={GET_PAGINATED_RESULTS_MAX_LOOPS_BEFORE_WARNING:5,SCREEN_HEIGHT_MEASUREMENTS:{[Device.model()]:{fullscreen:{landscape:Device.screenSize().height,portrait:Device.screenSize().height},notFullscreen:{landscape:Device.screenSize().height,portrait:Device.screenSize().height}}},FULLSCREEN_OPTS_MAX_ON_SCREEN:7,SCRIPTABLE_STORE_PATH:"/var/mobile/Library/Mobile Documents/iCloud~dk~simonbs~Scriptable/Documents/store",PERSISTED_LOG_FILENAME:"persistedLog",PERSISTED_LOG_MAX_LINES:1e3,ICON_TINTING_CACHED_ICON_PATH:"img/sfsymbols",ICON_PRELOAD_LIST_FILENAME:"sfSymbolPreloadList",UI_TABLE_DEFAULT_ROW_HEIGHT:"5%",UI_TABLE_DEFAULT_CELL_WIDTH_PERCENT:10,ON_TAP_CLICK_INTERVAL:200,TIME_PRESETS:[{label:"9:00",targetHourOfDay:9,icon:"clock"}]};const ne=e=>{const t=te[e];if(void 0===t)throw new Error(`You must register "${e}" in your implementation before using functions that depend on it.`);return t},re={ADD:"â¨",ARROW_DOWN:"â†“",ARROW_RIGHT:"â†’",ARROW_UP:"â†‘",BLOCK:"â–ˆ",CANCEL:"â“§",CHECKMARK_GREEN:"âœ…",CHEVRON_LEFT:"â€¹",CHEVRON_RIGHT:"â€º",ELLIPSIS:"â€¦",FOLDER:"ðŸ“",HEART:"â¤ï¸",MAGNIFYING_GLASS:"ðŸ”",NEST_ARROW:"â†³",OPEN_EXTERNAL:" â†—",PAPERCLIP:"ðŸ“Ž",PENCIL:"âœ",STAR:"âœ­",VERTICAL_ELLIPSIS:"â‹®",PLUS:"+",MINUS:"-"},ae=new Set(Object.keys(re)),oe=(e,n)=>t(e)?e.toLowerCase().includes(n.toLowerCase()):e.some((e=>e.toLowerCase()===n.toLowerCase())),ie=e=>e.replaceAll("'","&apos;").replaceAll('"',"&quot;"),se=(e,t)=>{const n=UUID.string(),r=new RegExp(t.source,t.flags.includes("g")?t.flags:t.flags+"g");return e.replace(r,n).split(n)},le=(e=new Date,{hours:t=0,minutes:n=0,seconds:r=0,ms:a=0}={})=>{const o=new Date(e);return o.setHours(t,n,r,a),o},ce=(de=864e5,(e,t)=>Math.floor(((e,t)=>e.getTime()-t.getTime())(e,t)/de));var de;const ue=(e,t)=>e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate(),he=e=>[String(e.getHours()).padStart(2,"0"),String(e.getMinutes()).padStart(2,"0")].join(":"),pe={YYYYMMDD:e=>[e.toLocaleDateString(void 0,{year:"numeric"}),e.toLocaleDateString(void 0,{month:"2-digit"}),e.toLocaleDateString(void 0,{day:"2-digit"})].join("-"),HHMM:he,HHMMSS:e=>[he(e),String(e.getSeconds()).padStart(2,"0")].join(":"),HHMMSSMMM:e=>[he,String(e.getSeconds()).padStart(2,"0"),String(e.getMilliseconds()).padStart(3,"0")].join(":"),DDDMMMDD:e=>e.toLocaleDateString(void 0,{weekday:"short",month:"short",day:"2-digit"}),MMMDD:e=>e.toLocaleDateString(void 0,{month:"short",day:"2-digit"}),MMDDNum:e=>e.toLocaleDateString(void 0,{month:"2-digit",day:"2-digit"}),MMDDYY:e=>`${e.getMonth()+1}/${e.getDate()}/${String(e.getFullYear()).slice(2)}`,MMDDYYWithPadding:e=>e.toLocaleDateString(void 0,{month:"2-digit",day:"2-digit",year:"2-digit"}),shortMMDDYY:e=>e.toLocaleDateString(void 0,{year:"2-digit",month:"numeric",day:"numeric"}),dayOfWeekNameFull:e=>e.toLocaleString("en-us",{weekday:"long"}),dayOfWeekNameShort:e=>e.toLocaleString("en-us",{weekday:"short"}),longDateAndTime:e=>e.toLocaleDateString(void 0,{month:"long",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})},ge=(e,t)=>pe[t](e),me=(e,{months:t=0,days:n=0,hours:r=0,minutes:a=0,seconds:o=0,ms:i=0}={})=>{const s=new Date(e);return s.setMonth(e.getMonth()+t),s.setDate(e.getDate()+n),s.setHours(e.getHours()+r,e.getMinutes()+a,e.getSeconds()+o,e.getMilliseconds()+i),s},fe=e=>{if(!/^\d{4}-\d{2}-\d{2}$/.test(e))throw new Error(`Passed date string ${e}, which is not correctly formatted`);const t=e.split("-"),n=Number.parseInt(t[0]),r=Number.parseInt(t[1]),a=Number.parseInt(t[2]),o=new Date;return o.setFullYear(n,r-1,a),le(o)};class we{queue;isRunning=!1;isPaused=!1;interval;maxEntitiesPerOperation;batchOperation;debug;isEqual;constructor({batchOperation:e,initQueue:t=[],interval:n=5e3,maxEntitiesPerOperation:r,debug:a=!1,isEqual:o=((e,t)=>e===t)}){this.queue=t,this.interval=n,this.maxEntitiesPerOperation=r||null,this.batchOperation=e,this.debug=a,this.isEqual=o}debugLog(e){this.debug&&console.log(e)}shiftQueue(){const e=[...this.queue];if(!this.maxEntitiesPerOperation)return this.queue=[],e;const t=e.splice(0,this.maxEntitiesPerOperation);return this.queue=e,t}async run(){if(this.isRunning)throw new Error("Queue already running");if(this.isPaused)throw new Error("Run called while paused");if(0===this.queue.length)return void this.debugLog("Nothing left in queue to run.");this.isRunning=!0;const e=this.shiftQueue();this.debugLog(`Running batch operation on ${e.length} entities, ${this.queue.length} remaining.`),this.queue.length>0&&this.snoozeRun(),e.length>0&&await this.batchOperation(e),this.queue.length>0&&this.snoozeRun(),this.isRunning=!1}snoozeRun(){this.isPaused?this.debugLog("Snooze run called while queue is paused."):((e,t)=>{const n=new Timer;n.timeInterval=e,new Promise((e=>n.schedule((async()=>{t&&await t(),e()}))))})(this.interval,(()=>{0!==this.queue.length?this.isRunning?this.snoozeRun():this.run():this.debugLog("After snoozing, there is nothing left in the queue to run.")}))}push(...e){const t=e.filter((e=>!this.queue.some((t=>this.isEqual(t,e)))));if(0!==t.length){for(const e of t)this.queue.push(e);this.isRunning||this.run()}else this.debugLog("Push: all of the pushed entities are in the queue.")}pause(){this.debugLog("Paused the queue"),this.isPaused=!0}resume(){this.debugLog("Resumed the queue"),this.isPaused=!1,this.isRunning||this.snoozeRun()}}class be{name;showStreamDataUpdateDebug;data;updateCallbacks=[];updateQueue;constructor({defaultState:e,name:t,showStreamDataUpdateDebug:n=!1}){this.showStreamDataUpdateDebug=n,this.data=e,this.name=t,this.updateCallbacks=[],this.updateQueue=new we({interval:0,maxEntitiesPerOperation:1,batchOperation:([{reducer:e,suppressChangeTrigger:t}])=>{const n={...this.data},r=e(n);this.data=r,t||this.runCallbacks(n,r)}})}registerUpdateCallback({callback:e,callbackId:t,overwriteExistingCallback:n=!0}){return this.updateCallbacks.some((({id:e})=>e===t))&&!n||(this.updateCallbacks=[...this.updateCallbacks.filter((({id:e})=>e!==t)),{callback:e,id:t}]),{remove:()=>this.unregisterUpdateCallback(t)}}unregisterUpdateCallback(e){this.updateCallbacks=this.updateCallbacks.filter((({id:t})=>t!==e))}runCallbacks(e,t){for(const{callback:n,id:r}of this.updateCallbacks)this.showStreamDataUpdateDebug&&console.log(`Running stream "${this.name}" update callback with ID "${r}"`),n(e,t)}updateData(e,{suppressChangeTrigger:t=!1}={}){this.updateQueue.push({reducer:e,suppressChangeTrigger:t})}setData(e,{suppressChangeTrigger:t=!1}={}){return this.updateData((()=>e),{suppressChangeTrigger:t})}updateAttr(e,t,{suppressChangeTrigger:n=!1}={}){return this.updateData((n=>({...n,[e]:t})),{suppressChangeTrigger:n})}triggerChange(){return this.runCallbacks(this.data,this.data)}getData(){return this.data}dangerouslyClearData(){this.data={}}}const ye=async({io:e,path:t})=>{e.isFileDownloaded(t)||await e.downloadFileFromiCloud(t)},Ce=e=>({useCache:n=false}={})=>{const{cache$:r,defaultData:a}=e;if(n){if(!r)throw new Error("Attempting to get data with cache, but cache is disabled.");return r.getData().data}return new Promise((n=>{(async e=>{const{io:n,path:r,defaultData:a}=e;if(!n.fileExists(r))return null;await ye(e);const o=n.readString(r);return t(a)?o:JSON.parse(o)})(e).then((e=>{const t=e??a;r&&r.setData({data:t}),n(t)}))}))},Se=e=>Ce(e)(),ve=e=>async({data:n})=>{await ye(e);const{path:r,prettify:a,io:o,defaultData:i,cache$:s}=e;return o.writeString(r,t(i)?n:JSON.stringify(n,null,a?2:void 0)),s&&s.setData({data:n}),n},Te=(e,t)=>ve(e)({data:t}),De=e=>()=>e.io.remove(e.path),Ee=e=>async t=>{const n=await Se(e);await Te(e,t(n))},_e=(e,t)=>({useCache:n=false,...r})=>{if(n){const n=(e=>Ce(e)({useCache:!0}))(e);return t({currData:n,...r})}return new Promise((n=>Se(e).then((e=>n(t({currData:e,...r}))))))},ke=(e,t)=>e===t,xe=(e,t,{areEntitiesEqual:n})=>e.some((e=>n(e,t))),Oe=e=>_e(e,(({currData:t,item:n})=>xe(t,n,e))),Fe=e=>async({item:t})=>{const n=await Se(e);xe(n,t,e)||await Te(e,[...n,t])},Ie=e=>async({items:t})=>{const n=await Se(e),r=(Array.isArray(t)?t:[t]).filter((t=>!xe(n,t,e)));0!==r.length&&await Te(e,[...n,...r])},Re=e=>async({item:t})=>{const n=await Se(e);await Te(e,n.filter((n=>!e.areEntitiesEqual(n,t))))},Me=e=>_e(e,(({currData:e,predicate:t})=>e.find(t))),Pe=e=>_e(e,(({currData:e,predicate:t})=>e.some(t))),Ae=e=>async t=>{const n=(await Se(e)).map(t);await Te(e,n)},Be=e=>async t=>{const n=await Se(e);await Te(e,n.filter(t))},Le=e=>_e(e,(({currData:e,key:t})=>D(e).includes(t))),$e=e=>_e(e,(({currData:e,key:t})=>e[t])),Ne=e=>async({key:t,value:n})=>{const r=await Se(e);r[t]=n,await Te(e,r)},qe=e=>async t=>{const n=await Se(e);delete n[t],await Te(e,n)},He=e=>{const t=(({filename:e,defaultData:t,directory:n=ne("SCRIPTABLE_STORE_PATH"),fileExtension:r="txt",prettify:a=!0,areEntitiesEqual:o=ke,disableCache:i=!1})=>({io:FileManager.iCloud(),path:`${n}/${e}.${r}`,prettify:a,defaultData:t,cache$:i?null:new be({name:`persisted cache ${e}`,defaultState:{data:t}}),areEntitiesEqual:o}))(e);return{cache$:t.cache$,getData:Ce(t),write:ve(t),reset:(n=t,()=>Te(n,n.defaultData)),reduce:Ee(t),deleteFile:De(t),has:Oe(t),add:Fe(t),concat:Ie(t),delete:Re(t),find:Me(t),some:Pe(t),map:Ae(t),filter:Be(t),hasKey:Le(t),get:$e(t),set:Ne(t),deleteObjKey:qe(t)};var n};He({filename:"calBlacklistTitles",defaultData:[]});const Ve=e=>{const t=Device.model(),n=ne("SCREEN_HEIGHT_MEASUREMENTS")[t];return n?n[e][Device.screenSize().width>Device.screenSize().height?"landscape":"portrait"]:(A(`No screen height settings for ${t}`),Device.screenSize().height)},Ue=(e,t)=>{switch(e){case"default":return t.setDefaultKeyboard();case"email":return t.setEmailAddressKeyboard();case"number":return t.setDecimalPadKeyboard();case"phone":return t.setPhonePadKeyboard();case"url":return t.setURLKeyboard();default:throw new Error(`Unmapped flavor ${String(e)}`)}};var je=async({title:e,message:t,textFields:n,buttons:r,presentAsSheet:a=!1})=>{const o=new Alert;o.title=e,t&&(o.message=t);const i=n&&D(n);n&&i&&((e,t)=>{for(const{placeholder:n="",initValue:r,flavor:a="default",font:o,textColor:i}of e){const e=t.addTextField(n,r);Ue(a,e),o&&(e.font=o),i&&(e.textColor=i)}})(i.map((e=>n[e])),o);const s=D(r);((e,t)=>{for(const{text:n,isCancel:r,isRed:a}of e)r?t.addCancelAction(n):a?t.addDestructiveAction(n):t.addAction(n)})(s.map((e=>({text:e,...r[e]}))),o);const l=a?await o.presentSheet():await o.present(),c=i?((e,t)=>Object.fromEntries(e.map(((e,n)=>[e,t.textFieldValue(n)||null]))))(i,o):{},d=((e,t,n)=>{const r=n.map((e=>({text:e,...t[e]})));if(-1===e){const e=r.find((e=>e.isCancel));if(!e)throw new Error("No cancel button included");return e}const a=r.filter((e=>!e.isCancel))[e];if(!a)throw new Error("Button is not there");return a})(l,r,s);return{textFieldResults:c,tappedButtonText:d.text}};const We={},ze=async(e="Confirm action?",{message:t,confirmButtonTitle:n="OK",cancelButtonTitle:r="Cancel",includeCancel:a=!0,presentAsSheet:o=!0,isSubmitRed:i=!1,onConfirm:s,onCancel:l,dontShowAgainKey:c}={})=>{if(Boolean(c&&We[c]))return await(s?.()),!0;const d=`${n} (stop asking)`,{tappedButtonText:u}=await je({title:e,message:t,buttons:{...a&&{[r]:{isCancel:!0}},[n]:{isRed:i},...c&&{[d]:{isRed:i}}},presentAsSheet:o});return u===r?(await(l?.()),!1):(u===d&&(h=!0,We[c]=h),await(s?.()),!0);var h},Ke=(e,{confirmButtonTitle:t="Delete",...n}={})=>ze(e,{isSubmitRed:!0,confirmButtonTitle:t,...n}),Ye=(e,t={})=>ze(e,{includeCancel:!1,...t}),Ge=e=>{const t=e.split("\n"),n=ne("PERSISTED_LOG_MAX_LINES");return t.length<=n?e:t.slice(t.length-n).join("\n")},Je=()=>He({filename:ne("PERSISTED_LOG_FILENAME"),defaultData:""});var Qe=async(e,{ignoreLineLimit:n=!1}={})=>{const r=t(e)?e:JSON.stringify(e,null,2),a=Je(),o=await a.getData(),i=new Date,s=[o,`${`${ge(i,"YYYYMMDD")}, ${ge(i,"HHMM")}`} (${Device.isPhone()?"phone":"iPad"}): ${r}`].filter(Boolean).join("\n");await a.write({data:n?s:Ge(s)})};const Xe=(e,t)=>{Ye(`Error in ${t} (see log)`,{message:String(e)}),Qe({type:"Error",error:JSON.stringify(e)})},Ze=({preReducers:e=[],postReducers:t=[]}={})=>n=>(...r)=>L(...e,(e=>n(e,...r)),...t),et=(e,t,{onStateUpdate:n}={})=>r=>async(...a)=>{const o=e(),i=(await r(...a))(o);t(i),await(n?.(i))},tt=e=>{const t=new Timer;return t.timeInterval=e,t.repeats=!0,t},nt={};class rt{onFire;onStop;interval;timer;repeatCount;maxRepeatCount;isRunning;fireImmediately;id=UUID.string();constructor({onFire:e,onStop:t,interval:n=1e3,timeout:r=18e5,fireImmediately:a=!1}={}){this.onFire=e,this.onStop=t,this.interval=n,this.timer=tt(n),this.repeatCount=0,this.maxRepeatCount=r?r/n:null,this.isRunning=!1,this.fireImmediately=a,nt[this.id]=this}setOnFire(e){this.onFire=e}async start(){if(!this.onFire)throw new Error("Can not start repeatinng timer w/o onFire callback set");this.timer.schedule((async()=>{try{await this.onFire()}catch(e){Xe(e,"RepeatingTimer/Scheduled onFire")}this.maxRepeatCount&&(this.repeatCount++,this.repeatCount>=this.maxRepeatCount&&await this.stop())})),this.isRunning=!0;try{this.fireImmediately&&await this.onFire()}catch(e){Xe(e,"RepeatingTimer/Start")}}resetCurrent(){if(!this.isRunning)throw new Error("Can not reset a timer that is not running");this.timer.invalidate(),this.timer=tt(this.interval),this.start()}async stop(){this.timer.invalidate();try{this.onStop&&await this.onStop()}catch(e){Xe(e,"RepeatingTimer/stop")}this.isRunning=!1}}var at={add_event:"calendar.badge.plus",add:"plus",alarm:"alarm",alert:"bell",archive:"archivebox",arrow_left:"arrow.left",arrow_right:"arrow.right",arrow_up:"arrow.up",arrow_uturn_down:"arrow.uturn.down",asterisk:"asterisk",attachment:"paperclip",backlog:"arrowtriangle.left",bell_fill:"bell.fill",bell:"bell",book:"book.closed",bookmark_remove:"bookmark.slash",bookmark:"bookmark",brain:"brain",branch:"arrow.triangle.branch",browser:"safari",bug:"ant",cake:"birthday.cake",calendar_circle:"calendar.circle",calendar:"calendar",cancel:"xmark",car:"car",card_stack:"square.stack.3d.down.right",chat:"bubble.right",checklist_checked:"checklist.checked",checklist:"checklist",checkmark:"checkmark",chevron_down:"chevron.down",chevron_left_fill:"chevron.left.square.fill",chevron_left:"chevron.left",chevron_right_fill:"chevron.right.square.fill",chevron_right:"chevron.right",chevron_up:"chevron.up",circle_done_filled:"checkmark.circle.fill",circle_done:"checkmark.circle",circle_filled:"largecircle.fill.circle",circle:"circle",circled_checkmark_filled:"checkmark.circle.fill",circled_exclamation_filled:"exclamationmark.circle.fill",circled_exclamation:"exclamationmark.circle",circled_question_filled:"questionmark.circle.fill",circled_question:"questionmark.circle",clipboard:"clipboard.fill",clock_fill:"clock.fill",clock:"clock",code:"chevron.left.forwardslash.chevron.right",collapse_vertical:"rectangle.compress.vertical",collapse:"minus.square",comment:"bubble.right",cycle:"arrow.3.trianglepath",danger_question:"questionmark.diamond",dash_list:"list.dash",dashboard:"gauge",delete_event:"calendar.badge.minus",delete_milestone:"flag.slash.circle",delete:"bin.xmark",display:"display",document:"doc",dot_in_circle:"smallcircle.fill.circle",download_local:"square.and.arrow.down",dropdown:"chevron.down.circle",dropright:"chevron.right.circle",dropup:"chevron.up.circle",edit:"pencil",ellipsis_circle:"ellipsis.circle",ellipsis:"ellipsis",email:"envelope",exclamation:"exclamationmark",expand_vertical_2:"chevron.up.chevron.down",expand_vertical:"rectangle.expand.vertical",expand:"plus.square",filter:"line.horizontal.3.decrease.circle",folder_circle:"folder.circle",folder_question:"questionmark.folder.fill",folder:"folder",font:"textformat",fork_knife:"fork.knife",forward:"arrowshape.turn.up.right",future:"chevron.right.2",gift:"gift",go_back:"arrow.left.circle",go_forward:"arrow.right.circle",grid:"rectangle.3.offgrid",hamburger:"text.justify",hashtag:"number",heart:"heart.fill",hide:"eye.slash",home:"house",html_close_tag:"chevron.left.slash.chevron.right",inbox:"tray.and.arrow.down",indented_list:"list.bullet.indent",info:"info.circle",ipad:"ipad",iphone:"iphone",kg:"k.circle",laptop:"laptopcomputer",lightbulb:"lightbulb",link:"link",list_in_circle:"list.bullet.circle",lock:"lock",megaphone:"megaphone",merge:"arrow.triangle.merge",milestone:"flag.circle",money:"dollarsign.square",moon_circle:"moon.circle",no:"nosign",not_downloaded:"icloud.slash",notes:"doc.plaintext",notification:"bell",num_sqr_1:"1.square",num_sqr_10:"10.square",num_sqr_11:"11.square",num_sqr_12:"12.square",num_sqr_13:"13.square",num_sqr_14:"14.square",num_sqr_15:"15.square",num_sqr_2:"2.square",num_sqr_3:"3.square",num_sqr_4:"4.square",num_sqr_5:"5.square",num_sqr_6:"6.square",num_sqr_7:"7.square",num_sqr_8:"8.square",num_sqr_9:"9.square",numbered_list:"list.number",numbers:"textformat.123",open_external:"arrow.up.right",palette:"paintpalette",parent_child_holding_hands:"figure.and.child.holdinghands",party:"party.popper",pause_skinny:"pause",pause:"pause.circle",person:"person",photo:"photo",pin_fill:"pin.fill",pin:"pin",plane:"airplane",play:"play",playing:"figure.play",point:"hand.point.up.left",questionmark:"questionmark",refresh:"arrow.clockwise",reply:"arrowshape.turn.up.left",search_document:"doc.text.magnifyingglass",search:"magnifyingglass",select_all:"square.grid.3x2",send_mail:"paperplane",settings:"gear",share:"square.and.arrow.up",shared_fill:"person.2.fill",shared:"person.2",shopping_add:"cart.badge.plus",shopping:"cart",show:"eye",sleep:"sleep",social_distancing:"figure.stand.line.dotted.figure.stand",sort:"arrow.up.arrow.down",split:"square.split.2x1",square_fill:"square.fill",square:"square",star_circled:"star.circle",star_filled:"star.fill",star:"star",stocks:"chart.line.uptrend.xyaxis",stop_sign:"octagon",stop_with_x:"xmark.octagon",stop:"hand.raised",stream:"water.waves",subtask:"arrow.turn.down.right",sun:"sun.max",sunrise:"sunrise",tag:"tag",task_complete:"checkmark.square",task_incomplete:"square",task_partial:"minus.square",text_box:"textbox",text_cursor:"text.cursor",thermometer:"medical.thermometer",thumbs_down:"hand.thumbsdown",thumbs_up:"hand.thumbsup",timer:"timer",tray_circled:"tray.circle",tray:"tray.fill",turtle:"tortoise",undo:"arrow.uturn.left",unpin_fill:"pin.slash.fill",video:"video",waiting:"hourglass",warning:"exclamationmark.triangle",weight:"scalemass",work:"briefcase",x_in_circle:"xmark.circle",x_in_square:"xmark.square"};const ot=(e,t)=>`${e}--${t}`,it=e=>{const[t,n]=e.split("--");return{iconKey:t,color:new Color(n)}},st=new Set(Object.keys(at)),lt=e=>st.has(e),ct=(()=>{let e=null;return()=>e||(e=He({defaultData:{},filename:ne("ICON_PRELOAD_LIST_FILENAME")}),e)})(),dt=()=>({script:Script.name(),mode:Device.isUsingDarkAppearance()?"dark":"light"}),ut=e=>{const{script:t,mode:n}=dt();return r=>{r[t]={light:r[t]?.light??[],dark:r[t]?.dark??[]};return r[t][n].includes(e)||r[t][n].push(e),r}},ht=new we({batchOperation:async e=>{const t=((e,t)=>{const{script:n,mode:r}=dt();return((e,...t)=>e.filter((e=>!t.includes(e))))(e,...t[n]?.[r]??[])})(e,await ct().getData());t.length>0&&await ct().reduce(B(...t.map(ut)))}}),pt=async({description:e,initialDate:t,useMinimumDate:n=false,onCancel:r=(()=>{}),onSubmit:a=(()=>{})}={})=>{try{if(e){if(!await ze(e,{confirmButtonTitle:"Choose date"}))throw new Error("Cancelled")}const r=new DatePicker;n&&(r.minimumDate=t||new Date),t&&(r.initialDate=t);const o=await r.pickDate();return await a(o),o}catch{return await r(),null}};var gt=async(e=new Date)=>{try{const t=new DatePicker;t.initialDate=e;return await t.pickDateAndTime()}catch{return null}};const mt=e=>({isValid:Boolean(e&&e>0),width:e}),ft=e=>Number.parseInt(e.replaceAll("%","")),wt=({height:t=ne("UI_TABLE_DEFAULT_ROW_HEIGHT"),mode:n})=>e(t)?t:((e,t="notFullscreen")=>{const n=ft(e);if(n<1||n>100)throw new Error(`Percent value must be between 1-100, actual: ${e}`);const r=n/100;return Math.floor(r*Ve(t))})(t,n),bt=(e,t)=>t.isFaded?((e,t)=>ee({from:e,to:t,numPoints:1})[0])(e,t.bgColor??K("bg")):e,yt=({dismissOnTap:e,...t})=>({dismissTableOnTap:e,...t}),Ct=(e,t,n)=>{if(!e)return null;const r=t.color,a=r&&bt(r,t),{color:o,height:i}=((e,t)=>{if(Array.isArray(e)){const[t,n]=e;return{height:t,color:n}}return{height:e,color:t??K("hr")}})(e,a);return St({bgColor:o,height:i,...yt(n)})},St=e=>e,vt=e=>`${e}%`,Tt=e=>S(e,["dismissOnTap","onDoubleTap","onTap","onTripleTap","overrideClickMap"]),Dt=e=>({DESCRIPTION:String(e),style:e.style,parent:e.parent?Dt(e.parent):null});class Et{parent=null;style;description="ELEMENT";constructor(e){this.style=e}setParent(e){this.parent=e}setDescription(e){this.description=e}toString(){return this.description}inheritStyle(){if(!this.parent)return;const{debug:e,...t}=this.parent.style;var n;this.style={...t,...this.style},this.style.debug&&(n=Dt(this),console.log(JSON.stringify(n,null,2)))}render(){throw new Error("Render not implemented")}}let _t=class extends Et{getCellOptsWithCalibratedWidth;constructor({style:e,getCellOptsWithCalibratedWidth:t}){super(e),this.getCellOptsWithCalibratedWidth=t}render(){return this.inheritStyle(),this}};const kt=e=>e instanceof xt;class xt extends Et{tapProps;children;constructor(e,t,n){super(t),this.tapProps=n,this.children=e;for(const e of this.children)e.setParent(this)}getBgColor(){return this.style.bgColor??K("bg")}wrapRowsWithSpacingAndBorder(e){const{borderBottomRow:t,borderTopRow:n,marginBottomRow:r,marginTopRow:a,paddingBottomRow:o,paddingTopRow:i}=((e,t,n)=>{const r=K("bg"),a=yt(n),{borderBottom:o,borderTop:i,marginBottom:s,marginTop:l,paddingBottom:c,paddingTop:d}=e;return{paddingTopRow:d&&St({height:d,bgColor:t,...a}),paddingBottomRow:c&&St({height:c,bgColor:t,...a}),marginTopRow:l&&St({height:l,bgColor:r}),marginBottomRow:s&&St({height:s,bgColor:r}),borderTopRow:Ct(i,e,n),borderBottomRow:Ct(o,e,n)}})(this.style,this.getBgColor(),this.tapProps);return M([a,n,i,...e,o,t,r])}getPartialBaseRowOpts(){return{height:wt(this.style),bgColor:this.getBgColor(),...yt(this.tapProps)}}render(){if(this.inheritStyle(),0===this.children.length)return this.wrapRowsWithSpacingAndBorder([this.getPartialBaseRowOpts()]);if(this.children.every(kt))return this.wrapRowsWithSpacingAndBorder((e=this.children,e.map(((e,t,n)=>{if(!e.style.borderTop)return e;const r=n[t-1];return r?.style.borderBottom?(Boolean(r.style.marginBottom||e.style.marginTop)||(e.style.borderTop=0),e):e}))).flatMap((e=>(e.tapProps={...this.tapProps,...e.tapProps},e.render()))));var e;if(this.children.some(kt))throw new Error("If a Container has a Container child, all siblings must also be Containers");const t=this.children.flatMap((e=>e.render())),n=(e=>{const t=x(e);return(100===t?e:e.map((e=>e/t*100))).map((e=>Math.floor(e)))})((e=>{const t=e.map(mt),n=t.filter((({isValid:e})=>!e)).length;if(!n)return e;const r=100-x(t.map((({width:e,isValid:t})=>t?e:0)));return t.map((({width:e,isValid:t})=>t?e:r<=0?ne("UI_TABLE_DEFAULT_CELL_WIDTH_PERCENT"):r/n))})(t.map((e=>e.style.width?ft(e.style.width):void 0)))),r={cells:t.map(((e,t)=>{const r=n[t];return e.getCellOptsWithCalibratedWidth(e.style,r)})),...this.getPartialBaseRowOpts()};return this.wrapRowsWithSpacingAndBorder([r])}}class Ot extends Et{children;constructor(e,t){super(t),this.children=e;for(const e of this.children)e.setParent(this)}render(){return this.inheritStyle(),this.children.map((e=>e.render()))}}const Ft=(e,t={})=>{const r=e.filter(n),a=new xt(r,t,Tt(t));return a.setDescription(`DIV > shownCells: ${r.length}`),a},It=["onTap","onDoubleTap","onTripleTap","dismissOnTap","overrideClickMap"],Rt=e=>{const t={};for(const n of D(e))It.includes(n)||(t[n]=void 0);return t},Mt=(e,t={})=>Ft([Ft(e,Rt(t))],t);let Pt=class extends xt{constructor(e){super([],e,{}),this.setDescription("HR")}render(){const{bgColor:e=K("hr"),height:t=1,marginTop:n=8,marginBottom:r=8}=this.style;return this.style={...this.style,bgColor:e,height:t,marginTop:n,marginBottom:r},super.render()}};var At=({color:e,...t}={})=>new Pt({bgColor:e,...t});const Bt={numShownSteps:2,stepRowHeight:1,fadeUntilPercentOfTo:1},Lt=({from:e,mode:t,to:n=K("bg"),stepOptions:{fadeUntilPercentOfTo:r=Bt.fadeUntilPercentOfTo,numShownSteps:a=Bt.numShownSteps,stepRowHeight:o=Bt.stepRowHeight}=Bt})=>{const i=Math.floor(a/r),s=ee({from:e,to:n,numPoints:i}).slice(0,a).map((e=>At({height:o,color:e,marginBottom:0,marginTop:0}))),l=Ft("DOWN"===t?s:s.reverse());return l.setDescription(`GRADIENT > ${t}`),l},$t={textSize:22,fontConstructor:e=>Font.boldSystemFont(e),paddingTop:"md",paddingBottom:"lg"},Nt=({color:e,bgColor:n,...r})=>({...r,color:t(e)?K(e):e,bgColor:t(n)?K(n):n}),qt={borderTop:0,borderBottom:0},Ht=()=>Nt({bgColor:"deep_blue",color:"gray2"}),Vt=()=>Nt({bgColor:"bg",color:"primaryTextColor"}),Ut=()=>Nt({bgColor:Y("gray0","gray8"),color:"primaryTextColor"}),jt={font:$t.fontConstructor},Wt=()=>Nt({paddingTop:10,paddingBottom:10,height:40,fontSize:22}),zt=()=>({flavors:{default:Ut(),defaultNoBorder:Nt({...Ut(),...qt}),happy:Nt({bgColor:"caribbean_green",color:"white"}),warning:Nt({bgColor:"jasmine",color:"field_drab"}),danger:Nt({bgColor:"red_500",color:"white"}),transparent:Nt({...Vt(),...qt}),transparentH1:Nt({...Vt(),...qt,...jt}),transparentWithBorder:Nt({...Vt()}),serene:Ht(),sereneH1:Nt({...Ht(),...jt,...qt}),domainPersonal:Nt({bgColor:"domain_personal",color:"white"}),domainWork:Nt({bgColor:"domain_work",color:"white"}),primary:Nt({bgColor:Y("majorelle_blue","neon_blue"),color:Y("magnolia","white")}),secondary:Nt({bgColor:Y("slate_100","black_coral"),color:Y("slate_700","platinum")})},button:{default:Wt(),large:Nt({...Wt(),height:50,fontSize:26,paddingTop:20,paddingBottom:20})}}),Kt=e=>{const t=FileManager.iCloud();return t.fileExists(e)||t.createDirectory(e),e},Yt=()=>[ne("SCRIPTABLE_STORE_PATH"),ne("ICON_TINTING_CACHED_ICON_PATH")].join("/"),Gt=new Map,Jt=e=>`${Yt()}/${e}.png`,Qt=(e,t)=>{Kt(Yt());const n=ot(e,t),r=Gt.get(n);if(r)return r;const a=Jt(n);return FileManager.iCloud().fileExists(a)?((async(e,t)=>{const n=FileManager.iCloud();n.isFileDownloaded(t)||await n.downloadFileFromiCloud(t);const r=n.readImage(t);if(!r)throw new Error(`Can not load icon ${e}`);Gt.set(e,r)})(n,a),"LOADING_FILE"):"FILE_DOES_NOT_EXIST"},Xt=(e,t,n)=>{Kt(Yt());const r=ot(e,t);FileManager.iCloud().fileExists(Jt(r))||((e,t)=>{const n=FileManager.iCloud(),r=Jt(e);n.writeImage(r,t),Gt.set(e,t)})(r,n)},Zt=t=>{const n=(e=>!!e&&(!0===e?{}:e))(t);if(!n)return n;const{lower:r,upper:a}=n;return{lower:o(e(r)?r:0,0,1),upper:o(e(a)?a:1,0,1)}},en={sfSymbol:{hueMargin:130,lightnessMargin:.4,currentColor:void 0,replaceSaturation:!0,replaceLightness:!0,noWarnings:!0}};var tn=async(e,r,a="sfSymbol")=>{const i=`\n  <img id="image" src="data:image/png;base64,${Data.fromPNG(e).toBase64String()}" />\n  <canvas id="canvas"></canvas>\n  `,s=((e,{currentColor:t,noWarnings:n,replaceLightness:r,replaceSaturation:a,hueMargin:o,lightnessMargin:i})=>`\nfunction rgbToHsl(r, g, b) {\n    r /= 255, g /= 255, b /= 255;\n    var max = Math.max(r, g, b),\n        min = Math.min(r, g, b);\n    var h, s, l = (max + min) / 2;\n\n    if (max == min) {\n        h = s = 0; // achromatic\n    } else {\n        var d = max - min;\n        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);\n        switch (max) {\n            case r:\n                h = (g - b) / d + (g < b ? 6 : 0);\n                break;\n            case g:\n                h = (b - r) / d + 2;\n                break;\n            case b:\n                h = (r - g) / d + 4;\n                break;\n        }\n        h /= 6;\n    }\n\n    return ({\n        h: h,\n        s: s,\n        l: l,\n    });\n}\n\n\nfunction hslToRgb(h, s, l) {\n    var r, g, b;\n\n    if (s == 0) {\n        r = g = b = l; // achromatic\n    } else {\n        function hue2rgb(p, q, t) {\n            if (t < 0) t += 1;\n            if (t > 1) t -= 1;\n            if (t < 1 / 6) return p + (q - p) * 6 * t;\n            if (t < 1 / 2) return q;\n            if (t < 2 / 3) return p + (q - p) * (2 / 3 - t) * 6;\n            return p;\n        }\n\n        var q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n        var p = 2 * l - q;\n        r = hue2rgb(p, q, h + 1 / 3);\n        g = hue2rgb(p, q, h);\n        b = hue2rgb(p, q, h - 1 / 3);\n    }\n\n    return ({\n        r: Math.round(r * 255),\n        g: Math.round(g * 255),\n        b: Math.round(b * 255),\n    });\n}\n\nfunction toHex(r, g, b) {\n  return "0x" + r.toString(16) + g.toString(16) + b.toString(16);\n}\n\n\nlet img = document.getElementById("image");\nlet canvas = document.getElementById("canvas");\nlet color = 0x${e.hex};\nlet oldColor = ${JSON.stringify(t.map((e=>e instanceof Color?'"0x'+e.hex+'"':e)))};\nlet targetHsl = rgbToHsl(\n  (color >> 16) & 0xFF,\n  (color >> 8) & 0xFF,\n  color & 0xFF,\n);\ntargetHsl.h *= 360;\nlet oldHsl = oldColor.map(\n  (c) => {\n    if (typeof c === "string") {\n      c = parseInt(c);\n      const hsl = rgbToHsl(\n        (c >> 16) & 0xFF,\n        (c >> 8) & 0xFF,\n        c & 0xFF,\n      );\n      hsl.h *= 360;\n      return hsl;\n    } else {\n      return {\n        h: c,\n        s: 1,\n        l: 0.5,\n      };\n    }\n  }\n);\nconst hasOldColor = oldHsl.length > 0;\n\ncanvas.width = img.width;\ncanvas.height = img.height;\nlet ctx = canvas.getContext("2d");\nctx.drawImage(img, 0, 0);\nlet imgData = ctx.getImageData(0, 0, img.width, img.height);\n// ordered in RGBA format\nlet data = imgData.data;\n\n// order: hue saturation luminance alpha (alpha is not filled)\nconst hslData = new Array(data.length);\nconst colorMap = new Map();\nfor (let i = 0; i < data.length; i += 4) {\n  let hsl = rgbToHsl(data[i + 0], data[i + 1], data[i + 2]);\n  hsl.h *= 360;\n  hslData[i + 0] = hsl.h;\n  hslData[i + 1] = hsl.s;\n  hslData[i + 2] = hsl.l;\n  const hue = Math.round(hsl.h);\n\n  if (!hasOldColor && data[i + 3] > 0) {\n    const current = colorMap.has(hue) ? colorMap.get(hue) : 0;\n    colorMap.set(hue, current + 1);\n  }\n}\n\nlet maxHue = 0;\nlet maxHueCount = 0;\nif (!hasOldColor) {\n  for (const [hue, count] of colorMap) {\n    if (count > maxHueCount) {\n      maxHue = hue;\n      maxHueCount = count;\n    }\n  }\n}\n\nlet warnedAboutGray = ${n};\nlet warnedAboutBlack = ${n};\nconst satBounds = ${JSON.stringify(a)};\nconst lightBounds = ${JSON.stringify(r)};\nfor (let i = 0; i < data.length; i += 4) {\n  if (data[i + 3] === 0) continue;\n  let diff = {\n    h: 0,\n    s: 0,\n    l: 0,\n  };\n  if (hasOldColor) {\n    diff = oldHsl\n      .map((hsl) => {\n        const ret = {\n          h: Math.abs(hslData[i] - hsl.h),\n          s: Math.abs(hslData[i + 1] - hsl.s),\n          l: Math.abs(hslData[i + 2] - hsl.l),\n        };\n        if (ret.h > 180) ret.h = 360 - ret.h;\n        return ret;\n      })\n      .reduce((prev, cur) => !prev ? cur : prev.h < cur.h ? prev : cur);\n  } else {\n    diff.h = Math.abs(hslData[i] - maxHue);\n    if (diff.h > 180) {\n      diff.h = 360 - diff.h;\n    }\n  }\n  if (diff.h < ${o} && diff.l < ${i}) {\n    let sat = hslData[i + 1];\n    if (satBounds && sat >= satBounds.lower && sat <= satBounds.upper) {\n      sat = targetHsl.s;\n    } else if (!satBounds && sat < 0.1 && !warnedAboutGray) {\n      warnedAboutGray = true;\n      logWarning(\n        "[replaceColor()] You tried replacing a grayish color without"\n        + " specifying that its saturation should also be replaced."\n      );\n    }\n    let light = hslData[i + 2];\n    if (\n      lightBounds\n      && light >= lightBounds.lower\n      && light <= lightBounds.upper\n    ) {\n      light = targetHsl.l;\n    } else if (\n      !lightBounds\n      && (light <= 0.1 || light >= 0.9)\n      && !warnedAboutBlack\n    ) {\n      warnedAboutBlack = true;\n      logWarning(\n        "[replaceColor()] You tried replacing a black or white color without"\n        + " specifying that its lightness should also be replaced. You"\n        + " should also specify that its saturation should be replaced, if"\n        + " you haven't done so already."\n      );\n    }\n    const rgb = hslToRgb(targetHsl.h / 360, sat, light);\n    data[i + 0] = rgb.r;\n    data[i + 1] = rgb.g;\n    data[i + 2] = rgb.b;\n  }\n}\nctx.putImageData(imgData, 0, 0);\ncanvas.toDataURL("image/png").replace(/^data:image\\/png;base64,/, "");\n`)(r,(({hueMargin:e,lightnessMargin:t,currentColor:r,replaceSaturation:a,replaceLightness:i,...s})=>({hueMargin:o(e,0,180),lightnessMargin:o(t,0,1),currentColor:(Array.isArray(r)?r:[r]).filter(n),replaceSaturation:Zt(a),replaceLightness:Zt(i),...s}))(en[a])),l=new WebView;await l.loadHTML(i);const c=await l.evaluateJavaScript(s);if(!t(c))throw new Error("Base64 conversion result is not a string");return Image.fromData(Data.fromBase64String(c))};const nn=(e,n=K("primaryTextColor"))=>{const r=(e=>{const t=SFSymbol.named(at[e]);if(!t)throw new Error(`Invalid SFSymbol key: ${e}`);return t.applyFont(Font.systemFont(53)),t.applyThinWeight(),t.image})(e);if(!n)return r;const a=n.hex;var o,i;o=e,i=a,ht.push(ot(o,i));const s=Qt(e,a);return t(s)?("FILE_DOES_NOT_EXIST"===s&&(async(e,t,n)=>{const r=await tn(e,t);Xt(n,t.hex,r)})(r,n,e),r):s},rn=e=>{const t=(e=>new we({maxEntitiesPerOperation:20,batchOperation:t=>{var n;y(t,f(w(it),(n=({iconKey:e,color:t})=>nn(e,t),e=>(t,r,a)=>(n(r,a),e(t,r,a))))),e?.()}}))(e);return{preloadIcons:async()=>t.push(...await(async()=>{const{script:e,mode:t}=dt(),n=await ct().getData();return n[e]?.[t]??[]})()),haltIconPreload:()=>t.pause()}};class an extends _t{constructor(e,{doNotTint:t=!1,...n}){super({style:n,getCellOptsWithCalibratedWidth:(n,r)=>{const{align:a="center",color:o=K("primaryTextColor"),font:i=(e=>Font.boldSystemFont(e)),fontSize:s=20}=n,l=bt(o,n);return lt(e)?{type:"image",value:nn(e,t?null:l),align:a,widthWeight:r}:{type:"text",value:re[e],align:a,widthWeight:r,color:l,font:i(s)}}})}}var on=(e,t={})=>{const n=new an(e,t);return n.setDescription(`ICON > key: "${e}"`),n};let sn=class extends _t{constructor(e,t){super({style:t,getCellOptsWithCalibratedWidth:({align:t="left",color:n=K("primaryTextColor"),font:r=(e=>Font.regularRoundedSystemFont(e)),fontSize:a=20},o)=>{const i=bt(n,this.style);return{type:"text",value:e,align:t,widthWeight:o,color:i,font:r(a)}}})}};var ln=(e,t={})=>{const n=new sn(e,t);var r,a;return n.setDescription(`P > text: "${r=e,a=20,r.length>a?r.slice(0,a)+re.ELLIPSIS:r}"`),n};const cn=(e,n,r)=>{return t(n)&&(a=n,ae.has(a)||lt(n))?{metadataCell:on(n,{...r,width:vt(10),align:"center"}),width:10}:e?{metadataCell:ln(String(e),{width:vt(20),align:"right",font:e=>Font.thinSystemFont(e),fontSize:15}),width:20}:{metadataCell:null,width:0};var a};var dn=({icon:e,text:t,metadata:n,metadataIcon:r,...a})=>{const{metadataCell:o,width:i}=cn(n,r,a),s=Ft([e&&on(e,{align:"center",width:vt(10)}),ln(t,{width:vt(100-(e?10:0)-i)}),o],{paddingTop:10,paddingBottom:10,...a});return s.setDescription(`THREECOL > text: "${t}"`),s};const un=[{flavor:"secondary",screenMode:"LIGHT"},{flavor:"transparent",screenMode:"ALL"}],hn=e=>{const t=Device.isUsingDarkAppearance()?"DARK":"LIGHT";return un.some((n=>n.flavor===e&&("ALL"===n.screenMode||n.screenMode===t)))},pn={isFaded:!0,onTap:void 0,onDoubleTap:void 0,onTripleTap:void 0,dismissOnTap:!1};var gn=({icon:e,text:t,isDisabled:n,isLarge:r,containerStyle:a,flavor:o="secondary",...i})=>{const s=(({userStyle:e,isDisabled:t,isLarge:n,flavor:r})=>({...zt().button[n?"large":"default"],...r&&zt().flavors[r],...e,...t&&pn}))({userStyle:i,isDisabled:n,isLarge:r,flavor:o}),l=i.bgColor??s.bgColor;if(!l)throw new Error(`No bgColor in Button "${t}". This is a symptom of passed props overwriting its value`);const c=i.color??s.color;if(!c)throw new Error(`No color in Button "${t}". This is a symptom of passed props overwriting its value`);const d=Mt([dn({...s,text:t,metadataIcon:e,borderBottom:0,borderTop:l.hex===K("bg").hex?[1,K("hr")]:0}),Lt({from:l,mode:"DOWN",...hn(o)&&{to:c}})],a);return d.setDescription(`BUTTON > text: "${t}"`),d},mn=e=>{const t=ln("",{width:e});return t.setDescription("HSPACE"),t},fn=(e,t={})=>{const r=new Ot(e.filter(n),t);return r.setDescription(`SPAN > children: ${e.length}`),r};const wn=({title:e,titleColor:t,titleIcon:n,hasDetails:r})=>Ft([ln(e,{color:t}),n&&on(n,{width:"10%"})],{paddingTop:10,paddingBottom:r?0:10}),bn=({text:e,icon:t,color:n})=>fn([t?on(t,{width:"8%",align:"left"}):mn("8%"),ln(e??"",{color:n,isFaded:!0})],{fontSize:16}),yn=({detailEl:e,paddingBottom:t})=>{return Ft((n=e,Array.isArray(n)?n.map((e=>e??{})):[n]).map(bn),{paddingBottom:t,height:32});var n};var Cn=({details:e,title:t,titleColor:r,containerStyle:a,titleIcon:o,contentsStyle:i})=>{const s=e.filter(n);return((e,{contentsStyle:t,containerStyle:n})=>Mt([Ft(e,t)],n))([wn({title:t,titleColor:r,titleIcon:o,hasDetails:s.length>0}),...s.map(((e,t,n)=>{const r=_(t,n)?10:0;return yn({detailEl:e,paddingBottom:r})}))],{containerStyle:a,contentsStyle:i})};const Sn={marginBottom:0,marginTop:0,paddingBottom:0,paddingTop:0},vn=(e,{titleColor:t,icon:n,...r})=>{const a=Tt(r),o=Boolean(a.onTap||a.onDoubleTap||a.onTripleTap),i=n??(o?"ellipsis_circle":null),s=vt(100-(i?10:0));return Ft(M([ln(e,{font:e=>Font.boldSystemFont(e),fontSize:25,width:s,color:t}),i&&on(i,{width:vt(10),isFaded:!0,color:t})]),{...Sn,...a})},Tn=(e,{subtitleColor:t,icon:n,...r})=>Ft([ln(e)],{font:()=>Font.footnote(),color:t,height:14,...Sn,...Tt(r)});var Dn=(e,t={})=>{const{subtitle:n,isFaded:r,marginBottom:a,marginTop:o}=t,i=Ft([vn(e,t),n&&Tn(n,t)],{marginTop:o,marginBottom:a,isFaded:r,paddingTop:10,paddingBottom:15,...Tt(t)});return i.setDescription(`H1 > title: ${e}`),i},En=(e,{icon:t,...n}={})=>{const r=Mt([Ft([ln(e,{font:e=>Font.mediumSystemFont(e),fontSize:20}),t&&on(t,{width:"10%"})],n)],{marginTop:15});return r.setDescription(`H2 > text: ${e}`),r};const _n=Y("gray0","gray1");var kn=(e,{completeColor:t=zt().flavors.primary.bgColor,...n}={})=>Ft(v(1,50).map((n=>(({isComplete:e,completeColor:t})=>ln("â–ˆ",{color:e?t:_n,font:e=>Font.ultraLightSystemFont(e),fontSize:10}))({isComplete:1===n||n/50<=o(e,0,1),completeColor:t}))),{...n,height:10});const xn=({columns:e,hideColumnNames:t})=>Mt([Lt({from:K("hr"),mode:"UP",stepOptions:{numShownSteps:3}}),!t&&Ft(T(e).map((([e,{width:t}])=>ln(e,{width:t}))),{bgColor:K("hr"),font:e=>Font.semiboldSystemFont(e),fontSize:16})]),On=({cellValues:e,onTap:t},n)=>Mt([fn(T(e).map((([e,t])=>((e,{isRowValueBold:t,width:n})=>ln(e,{width:n,...t&&{font:e=>Font.semiboldSystemFont(e)}}))(t,n[e]))),{fontSize:14})],{onTap:t,paddingTop:5,paddingBottom:5}),Fn=({columns:e,rows:t})=>{return Mt((n=t.map((t=>On(t,e))),r=At({marginTop:0,marginBottom:0}),n.length<2?n:n.flatMap(((e,t)=>_(t,n)?e:[e,r]))));var n,r};var In=({columns:e,rows:t,containerStyle:n,hideColumnNames:r})=>Mt([xn({columns:e,hideColumnNames:r}),Fn({columns:e,rows:t}),Lt({from:K("hr"),mode:"DOWN",stepOptions:{numShownSteps:5}})],{marginTop:10,marginBottom:10,...n});const Rn=["secondary","warning"];var Mn=({icon:t,title:n,showCloseIcon:r,flavor:a="secondary",metadata:o,description:i,...s})=>{const l=zt().flavors[a].bgColor,c=Ft([],{bgColor:l,height:4}),d=fn([(o||e(o))&&ln(String(o),{align:"center",width:"15%"}),r&&on("x_in_circle",{width:"8%"})],{font:()=>Font.footnote(),align:"center",isFaded:!0}),u=Ft([on(t,{width:"10%",...!Rn.includes(a)&&{color:l}}),ln(n),d]),h=i&&Ft([mn("10%"),ln(i,{font:()=>Font.footnote()})],{height:14}),p=Ft([Ft([u,h],{paddingTop:0,paddingBottom:0})],{paddingTop:i?5:14,paddingBottom:i?10:15,bgColor:Y("bg","gray8")}),g=Mt([c,p,Lt({from:K("selectedBgColor"),mode:"DOWN",stepOptions:{numShownSteps:5,stepRowHeight:2}})],{marginTop:6,marginBottom:6,...s});return g.setDescription("TOAST"),g},Pn=e=>(t,n={})=>Ft(t,{...e,...n}),An=e=>(t,n={})=>Mt(t,{...e,...n});const Bn=async(e,t)=>{console.warn(e);const n=new Alert;n.title=`Error in ${t} (see log)`,n.message=String(e),n.addAction("OK");const r="object"===a(e)&&"stack"in e?e.stack:void 0;Qe({type:"Error",context:t,error:JSON.stringify(e),stacktrace:r}),await n.present()},Ln=({type:e="button",widthWeight:n=1,align:r="center",onTap:a=(()=>{}),dismissOnTap:o=!1,value:i="",color:s,font:l}={})=>{const c=(()=>{if("image"===e&&!t(i))return UITableCell.image(i);if(!t(i))throw new Error("Trying to pass image into text cell.");return"button"===e?UITableCell.button(i):UITableCell.text(i)})();return c.widthWeight=n,{center:()=>c.centerAligned(),left:()=>c.leftAligned(),right:()=>c.rightAligned()}[r](),c.dismissOnTap=o,c.onTap=async()=>{try{await a()}catch(e){await Bn(e,`table cell with label "${String(i)}"`)}},s&&(c.titleColor=s),l&&(c.titleFont=l),c},$n=(()=>{let e=0;const t=new Timer;return n=>{t.timeInterval=ne("ON_TAP_CLICK_INTERVAL");const r=Math.max(...Object.keys(n).map((e=>Number.parseInt(e,10))));e++,t.invalidate();const a=async()=>{try{const t=n[e];if(!t)throw new u("Action at index not found",{tapCount:e,maxClicks:r,clickKeysPassed:Object.keys(n)});e=0,await t()}catch(e){Bn(e,"table row")}};r<=e?a():t.schedule(a)}})(),Nn=({cells:e=[],height:t,isHeader:n=!1,onTap:r=(()=>{}),onDoubleTap:a,onTripleTap:o,overrideClickMap:i,dismissTableOnTap:s=!1,bgColor:l}={})=>{const c=new UITableRow;if(c.isHeader=n,c.dismissOnSelect=s,c.onSelect=()=>$n(i??{1:r,...a&&{2:a},...o&&{3:o}}),t&&(c.height=t),l&&(c.backgroundColor=l),e.length>0)for(const t of e)c.addCell((d=t,Boolean(Object.keys(d).length>0&&!("type"in d))?t:Ln(t)));var d;return c};class qn{register={connected$Poller:{},payload$:{},persistedState$Poller:{},syncedPersistedState:{},iconPreloading:{}};set(e,t,n){this.register[e].start=t,this.register[e].cleanup=n}start(e){this.register[e].start?.()}cleanupAll(){for(const{cleanup:e}of Object.values(this.register))e?.()}}class Hn{table;payload$;connected$Poller;name;callbackID;isActive=!1;fullscreen;callbackRegister=new qn;syncedPersistedState;beforeLoad;beforeEveryRender;afterPropsLoad;afterFirstRender;onSecondRender;connected$;has;renderCount;defaultState;loadProps;getRows;onDismiss;onConnected$Update;constructor({name:e,showSeparators:t=!1,fullscreen:n=!1,beforeEveryRender:r,payload$:a,syncedPersistedState:o,connected$:i}){if(this.table=new UITable,this.table.showSeparators=t,this.name=e,this.fullscreen=n,this.syncedPersistedState=o,this.beforeEveryRender=r,this.payload$=a,this.connected$=i,this.has={state:Boolean(o),props:!1,runPrerenderCallbacks:!1},this.renderCount="NONE",this.callbackID=`Table: ${e}`,i){const e=(({$:e,...t},n)=>{let r=!1;const a=UUID.string();return e.registerUpdateCallback({callback:()=>r=!0,callbackId:a}),{timer:new rt({...t,onFire:()=>{r&&(r=!1,n())}}),cleanup:()=>e.unregisterUpdateCallback(a)}})(i,(()=>{const e=i.$.getData();this.payload$.updateData((({connected$ChangeCount:e,...t})=>({connected$ChangeCount:(e||0)+1,...t}))),this.onConnected$Update?.(e)}));this.connected$Poller=e.timer,this.callbackRegister.set("connected$Poller",(()=>this.connected$Poller.start()),(()=>{this.connected$Poller.stop(),e.cleanup()}))}this.callbackRegister.set("payload$",(()=>this.payload$.registerUpdateCallback({callback:()=>this.renderTable(),callbackId:this.callbackID})),(()=>{this.payload$.unregisterUpdateCallback(this.callbackID),this.payload$.setData({},{suppressChangeTrigger:!0})})),this.callbackRegister.set("syncedPersistedState",(()=>this.syncedPersistedState?.cache$.registerUpdateCallback({callbackId:this.callbackID,callback:e=>this.payload$.updateAttr("state",e.data)})),(()=>this.syncedPersistedState?.cache$.unregisterUpdateCallback(this.callbackID)));const{preloadIcons:s,haltIconPreload:l}=rn((()=>this.isActive&&this.renderTable()));this.callbackRegister.set("iconPreloading",s,l)}isTableActive(){return this.isActive}setState(e){const t=this.payload$.getData().state;if(!t)throw new Error("Setting state without initialized state");const n={...t,...e};this.payload$.updateAttr("state",n),this.syncedPersistedState?.reduce((e=>({...e,...n})))}setRenderOpts({loadProps:e,render:t,defaultState:n,onDismiss:r,beforeLoad:a,afterPropsLoad:o,afterFirstRender:i,onSecondRender:s,onConnected$Update:l,shouldPreloadIcons:c}){this.has.state=this.has.state||Boolean(n),this.has.props=Boolean(e||this.connected$),this.defaultState=n,this.loadProps=e,this.getRows=t,this.onDismiss=r,this.beforeLoad=a,this.afterPropsLoad=o,this.afterFirstRender=i,this.onSecondRender=s,this.onConnected$Update=l,this.isActive=!1,this.has.runPrerenderCallbacks=!1,this.renderCount="NONE",c&&this.callbackRegister.start("iconPreloading")}async initProps(){const e=await(this.loadProps?.());e&&(this.payload$.updateAttr("ownProps",e,{suppressChangeTrigger:!0}),await(this.afterPropsLoad?.()))}async beforeRender(){if(this.has.runPrerenderCallbacks)return;if(this.has.runPrerenderCallbacks=!0,await(this.beforeLoad?.()),await this.initProps(),this.callbackRegister.start("payload$"),!this.syncedPersistedState&&!this.defaultState)return;this.syncedPersistedState&&this.callbackRegister.start("persistedState$Poller");const e=await(this.syncedPersistedState?.getData())??this.defaultState;this.payload$.updateAttr("state",e,{suppressChangeTrigger:!0})}incrementRenderCount(){switch(this.renderCount){case"NONE":this.renderCount="ONCE";break;case"ONCE":this.renderCount="MANY"}}async runOnRenderCount(e,t){this.renderCount===e&&await(t?.())}async cleanup(){this.isActive=!1,await(this.onDismiss?.()),this.callbackRegister.cleanupAll()}async renderTable(){try{if(await this.beforeRender(),await(this.beforeEveryRender?.()),await this.runOnRenderCount("ONCE",this.onSecondRender),!this.getRows)throw new Error("`beforeRender` must be called first");if(((e,t)=>{e.removeAllRows();for(const n of t)if(n instanceof xt){const t=n.render();for(const n of t)e.addRow(Nn(n))}else e.addRow(n);e.reload()})(this.table,this.getRows().flat().filter(n)),await this.runOnRenderCount("NONE",this.afterFirstRender),this.incrementRenderCount(),!this.isActive){this.isActive=!0,this.callbackRegister.start("connected$Poller"),await this.table.present(this.fullscreen);const e=this.payload$.getData().state;return await this.cleanup(),e}}catch(e){await(async(e,t)=>{console.warn(e),await je({title:`Error encountered in ${t} render`,message:String(e),buttons:{OK:{}}})})(e,this.name)}}}const Vn=e=>{const t=new be({name:`table: ${e.name}`,defaultState:{}}),n=new Hn({...e,payload$:t}),r=()=>{const{state:e}=t.getData();if(!e)throw new Error("Getting state with no state present");return e},a=()=>{const{ownProps:n}=t.getData(),r=e.connected$,a=r?.$.getData(),o={...n,...a};if(!o)throw new Error("Getting props with no props present");return o},o=e=>n.setState(e),i=e=>{const t=e(r());null!=t&&o(t)},s=()=>n.renderTable();return{present:e=>(n.setRenderOpts(e),n.renderTable()),rerender:s,connect:e=>(...t)=>e({state:n.has.state?r():void 0,getProps:n.has.props?a:void 0,setState:o,updateState:i,rerender:s},...t),payload$:t,setState:o,updateState:i,getState:r,getProps:a,isTableActive:()=>n.isTableActive()}},Un={sm:5,md:10,lg:15},jn={sm:16,md:20,lg:22},Wn={sm:"4%",md:"5%",lg:"7%"},zn={selected:Y("gray1","gray7"),callout:K("secondaryTextColor")},Kn=(e,n,r)=>{const a=t(o=e)&&["lg","md","sm"].includes(o)?n[e]:e;var o;return(e=>t(e)&&e.includes("%"))(a)?((e,t="notFullscreen")=>{const n=e.split("%")[0];if(!n)throw new Error(`Incorrectly formatted percent value: ${e}`);const r=Number.parseInt(n,10);if(r<1||r>100)throw new Error(`Percent value must be between 1-100: ${e}`);const a=r/100;return Math.floor(a*Ve(t))})(a,r):a},Yn=e=>({paddingTop:Kn(e?.paddingTop??"sm",Un),paddingBottom:Kn(e?.paddingBottom??"sm",Un)}),Gn=({padding:e,rowHeight:t="sm",mode:n})=>({padding:Yn(e),rowHeight:Kn(t,Wn,n)}),Jn=e=>t(e)?zn[e]:e,Qn=({iconKey:n,text:r,isEmpty:a,image:o,color:i=K("primaryTextColor"),fontConstructor:s=(e=>Font.regularRoundedSystemFont(e)),textSize:l="sm",align:c="left",width:d},h)=>{const p={widthWeight:d,align:c},g=((e,{isFaded:t})=>t?new Color(e.hex,.6):e)(i,h);if(n)return Ln({type:"image",value:nn(n,g),...p});if(o)return Ln({type:"image",value:o,...p});if(void 0!==r||a)return Ln({type:"text",value:e(r)||t(r)?String(r):"",color:g,font:s(Kn(l,jn)),...p});throw new u("Cell configuration is invalid",{iconKey:n,text:r,isEmpty:a,hasImage:Boolean(o)})},Xn=(e,t,n)=>Nn({cells:[Qn({isEmpty:!0},t)],...n,height:e});var Zn=(e={})=>{const t=(({bgColor:e=K("bg"),rowHeight:t,padding:n,mode:r,content:a=[],...o})=>({...o,content:a,bgColor:Jn(e),...Gn({padding:n,rowHeight:t,mode:r})}))(e),r=y(t.content,f(w((e=>Qn(e,t))),(a=n,e=>(t,n,r)=>a(n,r)?e(t,n,r):t)));var a;const{bgColor:o,padding:i,rowHeight:s,dismissOnTap:l,onTap:c,onDoubleTap:d,onTripleTap:u}=t,h={onTap:c,onDoubleTap:d,onTripleTap:u,dismissTableOnTap:l,bgColor:o};return M([i.paddingTop&&Xn(i.paddingTop,t,h),Nn({cells:r.length>0?r:[Ln()],height:s,...h}),i.paddingBottom&&Xn(i.paddingBottom,t,h)]).flat()};var er=({rowHeight:e=15,...t}={})=>Zn({rowHeight:e,padding:{paddingTop:0,paddingBottom:0},...t});const tr=K("green_l2"),nr={underlineChar:[re.BLOCK,"â€“"],underlineCharRepeat:[5,7],textSize:["md","sm"],rowHeight:[24,20],underlineRowHeight:[20,2]},rr=(e,t)=>nr[e][t?1:0],ar=e=>Math.floor(10/e),or=e=>({text:e,align:"center",color:tr}),ir=e=>er({onTap:e}),sr=(e,t,{mapLabel:n,initValue:r,subtle:a=!1})=>(({mapLabel:e,subtle:t,label:n,isActive:r,tabWidth:a})=>({text:e?.(n)??n,align:"left",...!r&&{color:tr},width:a,textSize:rr("textSize",t)}))({mapLabel:n,label:e,isActive:e===r,subtle:a,tabWidth:ar(t)}),lr=e=>e-1,cr=(e,t,n)=>[o(e,0,lr(n)),o(t,0,lr(n))],dr=(e,t)=>cr(lr(e)-t+1,lr(e),e),ur=(e,t,n)=>{if(!(n>t))return(e=>cr(0,lr(e),e))(n);return n-e>t?cr(e,e+t-1,n):dr(n,t)},hr=(e,t,n)=>{const{currFrame:r,activeIndex:a}=e;if((([e,t],n)=>n>=e&&n<=t)(r,a))return r;const o=(({activeIndex:e,prevIndex:t},n)=>{if(null===t)throw new Error("Invalid prevIndex value");return 0===e&&t===lr(n)?"FORWARD":e===lr(n)&&0===t?"BACKWARD":e>t?"FORWARD":"BACKWARD"})(e,t);if("FORWARD"===o){return r[1]===lr(t)?((e,t)=>cr(0,e-1,t))(n,t):(([e,t],n)=>cr(e+1,t+1,n))(r,t)}return 0===r[0]?dr(t,n):(([e,t],n)=>cr(e-1,t-1,n))(r,t)},pr=new Map,gr=e=>{const t=pr.get(e);if(!t)throw new Error(`No cycle tabs state found for key ${e}`);return t},mr=(e,t,n,r)=>{const a=gr(e),o={activeIndex:t,prevIndex:a.activeIndex};pr.set(e,{...o,currFrame:hr({...a,...o},n,r)})};var fr=({labels:e,initValue:t,mapLabel:n,onTabChange:r,subtle:a=!1,maxPerPage:o=(Device.isPad()?4:3),name:i,rerenderParent:s})=>{((e,t,n,r)=>{if(pr.has(e))return;const a=n.length,o=r?n.indexOf(r):0,i=ur(o,t,a);pr.set(e,{activeIndex:o,prevIndex:null,currFrame:i})})(i,o,e,t);const{currFrame:l}=gr(i),c=e.length,d=()=>{const n=$(t,e);r({currTab:t,nextTab:n}),mr(i,e.indexOf(n),c,o),s()},u=()=>{const n=e.indexOf(t),a=n?n-1:e.length-1;r({currTab:t,nextTab:e[a]}),mr(i,a,c,o),s()},h=c>o,p=0!==l[0],g=h&&l[1]!==lr(c),m=e.slice(l[0],l[0]+o);return[ir(u),ir(u),Zn({content:M([p?or(re.CHEVRON_LEFT):{isEmpty:!0},...m.map((e=>sr(e,o,{mapLabel:n,initValue:t,subtle:a}))),g?or(re.CHEVRON_RIGHT):{isEmpty:!0}]),onTap:d,padding:{paddingBottom:0},rowHeight:rr("rowHeight",a)}),Zn({content:[{isEmpty:!0},...m.map((e=>((e,t,n)=>{const r=ar(n);return e?{text:rr("underlineChar",t).repeat(rr("underlineCharRepeat",t)),color:K("deep_blue_l1"),align:"left",width:r}:{isEmpty:!0,width:r}})(e===t,a,o))),{isEmpty:!0}],onTap:d,padding:{paddingTop:0,paddingBottom:0},rowHeight:rr("underlineRowHeight",a)})].flat()},wr=({title:e,badgeNumber:t,subtitle:n,...r})=>Dn(e,{subtitle:n||t?M([n,t]).join(", "):void 0,...r}),br=({label:e,color:t=Y("black","white"),iconKey:n,padding:r,...a})=>En(e,{color:t,icon:n,...a});const yr=e=>(t={})=>{const n=e(t);return n&&Zn(n(t))},Cr={padding:{paddingTop:0,paddingBottom:0}};var Sr=({dim:e=0,padding:{paddingBottom:t=0,paddingTop:n=0}={paddingBottom:0,paddingTop:0},color:r=K("hr"),height:a=1}={})=>M([n&&Zn({rowHeight:n,...Cr}),Zn({rowHeight:a,bgColor:d(r,e),...Cr}),t&&Zn({rowHeight:t,...Cr})]).flat();const vr={gutterLeft:"center",main:"left",gutterRight:"right"},Tr=(e,t,n)=>({...e,width:n[t],align:vr[t]});var Dr=yr((e=>{const{gutterLeft:t,main:n,gutterRight:r}=e;return a=>{const o=(({gutterLeft:e,gutterRight:t})=>{const n=(e&&1)??0,r=(t&&2)??0;return{gutterLeft:n,main:12-n-r,gutterRight:r}})(e);return{...a,content:M([t&&Tr(t,"gutterLeft",o),Tr(n,"main",o),r&&Tr(r,"gutterRight",o)])}}}));var Er=yr((({gutterLeft:e,main:t})=>n=>({...n,content:[{...e,width:1,align:"center"},{...t,width:11,align:"left"}]}))),_r=({icon:e,color:t,text:n,metadata:r,textSize:a,fontConstructor:o,...i})=>r?Dr({gutterLeft:{iconKey:e,color:t},main:{text:n,color:t,fontConstructor:o,textSize:a},gutterRight:{text:r,color:t},...i}):Er({gutterLeft:{iconKey:e,color:t},main:{text:n,color:t,fontConstructor:o,textSize:a},...i});const kr=new Map;var xr=({getEntities:e,getEntityRow:t,rerenderParent:n,name:r,pageSize:a=20})=>{var o;o=r,!kr.has(o)&&kr.set(o,1);const i=e(),s=v(1,Math.ceil(i.length/a)).map(String),l=s.length>1,c=kr.get(r),d=c<=s.length?c:1,u=((e,t,n)=>{const r=((e,t)=>t*(e-1))(t,n);return e.slice(r,r+n)})(i,d,a),h=l&&[fr({labels:s,initValue:String(d),name:r,rerenderParent:n,onTabChange:({nextTab:e})=>((e,t)=>kr.set(e,t))(r,Number.parseInt(e,10)),subtle:!0}),Sr()].flat(),p=l&&[er(),er()].flat(),g=u.map(t);return M([h,p,...g]).flat()};const{present:Or,connect:Fr}=Vn({name:"presetDateTime"}),Ir=e=>{const t=new Date,n=t.getHours(),r=le(t);return me(r,{days:n<e?0:1,hours:e})},Rr=Fr((({setState:e})=>gn({text:"Choose date & time",icon:"calendar",dismissOnTap:!0,onTap:()=>e({result:"CHOOSE_SPECIFIC"})}))),Mr=Fr((({setState:e},{label:t,icon:n,targetHourOfDay:r})=>Er({gutterLeft:{iconKey:n},main:{text:t,textSize:"md"},padding:{paddingBottom:"md",paddingTop:"md"},rowHeight:"md",dismissOnTap:!0,onTap:()=>e({result:Ir(r)})})));const{present:Pr,connect:Ar,getProps:Br,getState:Lr}=Vn({name:"pickRelativeDate"}),$r=e=>{const t=new Date,n=ue(t,e),r=ue(me(t,{days:1}),e),a=((e,t,n)=>t?"Today":n?"Tomorrow":ge(e,"DDDMMMDD"))(e,n,r);return{dateStr:a,incrementStr:n||r?null:`${e>t?"+":""}${ce(e,t)}`}},Nr=e=>{const{minimumDate:t,daysToInclude:n}=Br(),r=t?(a=t,o=e,new Date(Math.max(a.getTime(),o.getTime()))):e;var a,o;return v(0,n-1).map((e=>me(r,{days:e})))},qr=({goBack:e})=>{const{startDate:t}=Lr(),{daysToInclude:n}=Br();return me(t,{days:(e?-1:1)*n})},Hr=Ar((()=>{const{title:e,message:t}=Br();return Dn(e,{...t&&{subtitle:t}})})),Vr=Ar((({setState:e})=>{const{allowTimeSelection:t}=Br();return gn({text:t?"Choose date & time":"Use date picker",icon:"calendar",dismissOnTap:!0,onTap:()=>e(t?{useSpecificDateTimePicker:!0}:{useDatePicker:!0})})})),Ur=()=>Sr({dim:.4}),jr=({text:e,icon:t,onTap:n,isFaded:r=!1})=>[gn({icon:t,text:e,isFaded:r,onTap:n}),Ur()].flat(),Wr=Ar((({setState:e})=>{const t=!(()=>{const{minimumDate:e}=Br();return!e||Lr().startDate.getTime()>e.getTime()})();return jr({text:"Earlier",icon:"arrow_left",onTap:()=>!t&&e({startDate:qr({goBack:!0})}),isFaded:t})})),zr=Ar((({setState:e})=>jr({text:"Later",icon:"arrow_right",onTap:()=>e({startDate:qr({goBack:!1})})}))),Kr=Ar((({setState:e},t)=>{const{dateStr:n,incrementStr:r}=$r(t);return[_r({text:n,metadata:r||" ",icon:"calendar",onTap:()=>e({chosenDate:t}),dismissOnTap:!0}),Ur()].flat()})),Yr=Ar((({state:{startDate:e}})=>Nr(e).flatMap(Kr))),Gr=(e,t)=>e.useDatePicker?pt({initialDate:t.minimumDate||e.startDate,useMinimumDate:Boolean(t.minimumDate)}):e.useSpecificDateTimePicker?(async()=>{const{result:e}=await Or({defaultState:{result:null},render:()=>[Dn("Choose specific date & time"),Rr(),...ne("TIME_PRESETS").flatMap(Mr)]});return"CHOOSE_SPECIFIC"===e?gt():e})():e.chosenDate;const{deep_blue:Jr,domain_personal:Qr,domain_work:Xr,gray0:Zr,gray2:ea,gray8:ta,green_l4:na,green:ra,primaryTextColor:aa,red_d1:oa,red_l4:ia,yellow_d2:sa,yellow_l3:la}=G();Y(Zr,ta),Y(Zr,ta);const ca=(e="default")=>zt().flavors[e];var da=async(e="Enter text",{submitText:t="OK",cancelText:n="Cancel",onSubmit:r=(()=>{}),onCancel:a=(()=>{}),message:o,initValue:i,placeholder:s,flavor:l,showClipboardButton:c=!1}={})=>{const d=c&&Pasteboard.paste(),u=`ðŸ“‹ ${d}`,{textFieldResults:{inputText:h},tappedButtonText:p}=await je({title:e,message:o,buttons:{[n]:{isCancel:!0},...c&&d&&{[u]:{}},[t]:{}},textFields:{inputText:{placeholder:s,initValue:i,flavor:l}}}),g=p===u&&d||h,m=p===n;return m?await a():await r(g),m?"":g};const{getState:ua,setState:ha,present:pa,connect:ga}=Vn({name:"chooseColor"}),ma=Ze(),fa=et(ua,ha)(ma(((e,t)=>({...e,selectedColor:t})))),wa=W.map((e=>{const n=t(e)?z(e):e;return V(n)?n:new q({label:t(e)?e:UUID.string(),staticColor:n})})),ba=(e,t,n,r)=>{const{color:a,label:o,isDynamic:i}=e;return Zn({content:[{text:M([o,i&&"(dynamic)"]," "),color:t}],bgColor:a,rowHeight:30,dismissOnTap:r,onTap:n})},ya=ga((()=>wa.flatMap((e=>(({colorData:e,onTap:t,dismissOnTap:n=!1})=>[ba(e,K("white"),t,n),ba(e,K("black"),t,n)].flat())({colorData:e,onTap:()=>fa(e),dismissOnTap:!0})))));var Ca=async()=>{const{selectedColor:e}=await pa({defaultState:{selectedColor:null},render:()=>[Dn("Choose color"),gn({text:"Add custom",icon:"add",dismissOnTap:!0,onTap:()=>ha({selectedColor:"ADD_CUSTOM"})}),ya()]});if("ADD_CUSTOM"===e){const e=await da("Enter hex w/o #");return e?new q({label:e,staticColor:new Color(e)}):null}return e};const Sa=e=>Boolean(e%2)?K("bg"):Y("gray0","gray8"),va=e=>{const t=Ve("notFullscreen"),n=Math.floor(t/ne("FULLSCREEN_OPTS_MAX_ON_SCREEN")),r=Math.floor(t/e);return Math.max(r,n)};const Ta=async(e,{fallbackIcon:a="dot_in_circle",onCancel:o,onOptionSelect:i}={})=>{const s=await(async e=>{const{present:t,connect:n}=Vn({name:`fullscreenOpts ${UUID.string()}`}),a=n((({setState:e},{label:t,action:n,children:a,icon:o,flavor:i},s,l)=>{if(!n&&!a)throw new Error("Fullscreen option requires either an action or children");const c=Sa(l),d=i?ca(i).color:K("primaryTextColor");return Ft([on(o,{width:"10%"}),mn("10%"),ln(t,{font:()=>Font.title1()})],{color:d,bgColor:i?ca(i).bgColor:c,dismissOnTap:!a,height:va(s),onTap:async()=>{if(a){const t=r(a)?await a():a;e({nodes:t})}else n&&(e({selectedActionLabel:t}),n())}})})),o=n((({state:{nodes:e}})=>e.flatMap(((t,n)=>a(t,e.length,n))))),{selectedActionLabel:i}=await t({defaultState:{nodes:e,selectedActionLabel:null},render:()=>[o()],shouldPreloadIcons:!0});return i})(e.filter(n).map((e=>{if(t(e))return{label:e,icon:a,action:N};const{label:n,flavor:r,icon:o=a}=e;return{label:n,flavor:r,icon:o,action:N}})));if(null===s)return await(o?.()),null;const l=((e,r)=>{const a=r.filter(n).find((n=>t(n)?n===e:n.label===e));if(!a)throw new Error(`Expected to find selected label ${e} in listChoose options.`);return t(a)?a:a.value})(s,e);return await(i?.(l)),l},Da="Custom",Ea=({filterCategory:e,label:t})=>`${e}.${t}`,_a=(e,t)=>{const[n,r]=e.split(".");if(!n||!r)throw new Error(`Invalid key ${e}`);const a=t[n]?.find((e=>e.label===r));if(!a)throw new Error(`No filter found for ${e}`);return a},ka=({filterState:e},t)=>[...e.entries()].filter((([e,t])=>t)).map((([e,n])=>({..._a(e,t),state:n}))),xa=e=>{const t=e.filter((e=>e.state)).map((e=>[Ea(e),e.state]));return new Map(t)},Oa=({filterState:e})=>[...e.values()].some(Boolean),Fa=({state:e,icon:t})=>{switch(e){case null:return t??"task_incomplete";case"INCLUDE":return"checkmark";case"EXCLUDE":return"cancel"}},Ia=({state:e})=>{switch(e){case"INCLUDE":return"happy";case"EXCLUDE":return"danger";case null:return"default"}},Ra=(e,t,n,{getEntityId:r})=>{const a=new Set;for(const o of n){const n=r(o);e.allEntityIDs.add(n),t.includeEntity(o)&&a.add(n)}return e.filterKeyToMatchingIDs.set(Ea(t),a),e},Ma=(e,{filters:t},n)=>{const r=new Map;for(const a of Object.values(t).flat()){const t=Ea(a),o=n.get(t);if(!o)throw new Error(`No matching IDs for key ${t}`);r.set(t,[...e].filter((e=>o.has(e))).length)}return r},Pa=({allEntityIDs:e,filterKeyToMatchingIDs:t},n,r)=>{const a=(({filterKeyToMatchingIDs:e,allEntityIDs:t},n,{filters:r})=>{const a=ka(n,r);let o=[...t];for(const t of a){const n=[...e.get(Ea(t))];switch(t.state){case null:continue;case"INCLUDE":o=O(o,n);break;case"EXCLUDE":o=F(o,n)}}return new Set(o)})({allEntityIDs:e,filterKeyToMatchingIDs:t},n,r);return{numTotal:e.size,numFiltered:a.size,filterKeyToFilteredCount:Ma(a,r,t)}},Aa=async({loadFilterMatchData:e,prev$Props:t,props:n,state:r})=>{const a=e?await(async e=>{const t=await e.getEntities();let n={allEntityIDs:new Set,filterKeyToMatchingIDs:new Map};for(const r of Object.values(e.filters).flat())n=Ra(n,r,t,e);return n})(n):S(t,["filterKeyToMatchingIDs","allEntityIDs"]),o=Pa(a,r,n);return{...a,...o}},Ba=Ze(),La=Ba(((e,t)=>{const n=$(t.state,["INCLUDE","EXCLUDE",null]),r=new Map(e.filterState.entries());return r.set(Ea(t),n),{...e,filterState:r}})),$a=Ba((e=>({...e,filterState:new Map}))),Na=Ba(((e,t)=>({...e,collapsedFilterCategories:R(e.collapsedFilterCategories,t)})));var qa=async e=>{const{initAppliedFilters:t,beforeLoad:r,onDismiss:a,filters:o}=e,i=`entityFilter ${UUID.string()}`,s=new be({name:i,defaultState:{allEntityIDs:new Set,filterKeyToMatchingIDs:new Map,filterKeyToFilteredCount:new Map,numFiltered:0,numTotal:0}}),{present:l,connect:c,getState:d,setState:u,getProps:h,payload$:p}=Vn({name:i,connected$:{$:s}}),g=(({subscriptionName:e,dependent$:t,source$:n,stateReducer:r=(e=>e)})=>{return n.registerUpdateCallback({callbackId:e,callback:async(e,n)=>{const a=t.getData(),o=await r(a,e,n);o&&t.setData(o)}}),{unsubscribe:(a={source$:n,subscriptionName:e},()=>a.source$.unregisterUpdateCallback(a.subscriptionName))};var a})({subscriptionName:"update props$ on some state change",dependent$:s,source$:p,stateReducer:(t,{state:n},{state:r})=>{if(!n||!r)return null;return!C([...n.filterState.entries()],[...r.filterState.entries()])?Aa({prev$Props:t,props:e,state:r}):null}}),m=et(d,u),f=m(La),w=m($a),b=m(Na),y=c((()=>{const{title:e,numFiltered:t,numTotal:n}=h();return wr({title:e??"Filter entities",subtitle:`${t}/${n}`})})),S=c((({state:e})=>Ft([gn({text:"Clear filters",icon:"filter",onTap:w,isDisabled:!Oa(e),flavor:"transparentWithBorder"})]))),v=e=>{const{filterKeyToFilteredCount:t,numFiltered:n}=h(),r=null!==e.state,a=t.get(Ea(e));return(!a||a===n)&&!r?null:{text:e.label,icon:Fa(e),flavor:Ia(e),...a&&!r&&{metadata:a},onTap:()=>f(e)}},T=c(((e,t,n)=>br({label:t,iconKey:n?"expand":"collapse",padding:{paddingBottom:0,paddingTop:0},onTap:()=>b(t)}))),D=c((({state:e},t)=>{const r=e.collapsedFilterCategories.includes(t),a=h().filters[t].map((t=>((e,t)=>({...e,state:t.filterState.get(Ea(e))??null}))(t,e))).map(v).filter(n);return 0===a.length?null:M([T(t,r),!r&&Ft(a.map(gn)),er(),er()]).flat()})),E=c((()=>Object.keys(h().filters).flatMap(D))),_={filterState:xa(t??[]),collapsedFilterCategories:[]},k=await l({beforeLoad:()=>((async t=>{s.setData(await Aa({loadFilterMatchData:!0,prev$Props:s.getData(),props:e,state:t}))})(_),r?.()),onDismiss:()=>(g.unsubscribe(),a?.()),defaultState:_,loadProps:()=>e,render:()=>[y(),S(),er(),er(),er(),E()]});return ka(k,o)};const Ha=()=>({entityMap:new Map,allEntityIds:[],allEntitiesCount:0});var Va=async({beforeLoad:e,onClose:t,getEntities:r,getEntityRow:a,openEntity:o,bulkActions:i,getEntityId:s,getCustomCTAs:l,headerOpts:c,filters:d,getSearchMatchPredicate:u})=>{await(e?.());const h=`selectable entity browser ${UUID.string()}`,p=new be({defaultState:Ha(),name:h}),g=async({appliedFilters:e,filterBySearchQuery:t})=>{const n=await(async({getEntities:e,appliedFilters:t,getSearchMatchPredicate:n,filterBySearchQuery:r})=>{const a=(e=>t=>{let n=!0;for(const r of e){const e=r.includeEntity(t);if(n=n&&("INCLUDE"===r.state?e:!e),!n)break}return n})(t);return(await e()).filter((e=>!!a(e)&&(!n||!r||n(r)(e))))})({appliedFilters:e,filterBySearchQuery:t,getEntities:r,getSearchMatchPredicate:u}),a=((e,t)=>{const n=Ha();for(const r of e){const e=t(r);n.entityMap.set(e,r),n.allEntityIds.push(e),n.allEntitiesCount++}return n})(n,s);p.setData(a)},{present:m,connect:f,getProps:w,getState:b,setState:y,rerender:C}=Vn({name:h,connected$:{$:p}}),S=Ze(),v=S(((e,t)=>{const n=new Set(e.selectedEntityIds);return n.has(t)?n.delete(t):n.add(t),{...e,selectedEntityIds:n}})),T=S((e=>({...e,selectedEntityIds:new Set}))),D=S(((e,t)=>({...e,selectedEntityIds:new Set(t)}))),E=S(((e,t)=>({...e,filterBySearchQuery:t}))),_=S((e=>({...e,filterBySearchQuery:null}))),k=et(b,y),x=k(v),O=k(T),F=k(D),I=k(E),R=k(_),P=f((()=>wr(c||{title:"Entity browser"}))),A=()=>{if(!u)return null;const{filterBySearchQuery:e}=b();return{text:e?`"${e}" (tap to clear)`:"Search",isFaded:!e,icon:"search",onTap:async()=>{if(e)await R();else{const e=await da("Enter search query");if(!e)return;await I(e)}g(b())}}},B=()=>{if(!d)return null;const{appliedFilters:e}=b();return{text:"Edit filters",icon:"filter",...e.length>0&&{metadata:e.length},onTap:async()=>{const t=await qa({getEntities:r,filters:d,getEntityId:s,initAppliedFilters:e});y({appliedFilters:t}),g(b())}}},L=()=>{const{selectedEntityIds:e}=b(),{allEntitiesCount:t,allEntityIds:n}=w();if(!t||!i)return null;const r=e.size===t;return{text:r?"Clear selection":"Select all",icon:r?"cancel":"select_all",onTap:()=>r?O():F(n)}},$=f((({state:e})=>{const t=M([B(),A(),L(),...l?l({...w(),rerender:()=>g(e)}):[]]).map((e=>({...e})));return t.length>0&&Ft(t.map(gn))})),N=e=>{const t=b(),{selectedEntityIds:r}=t,s=w(),{entityMap:l}=s,c=r.size,d=r.has(e),u=l.get(e),h={...s,rerender:C,entity:u};return a({entity:u,isSelected:d,onTap:async()=>{if(c)return x(e);await o(h),g(t)},onDoubleTap:async()=>{if(!c)return F([e]);if(d&&c>1){const e=[...r].map((e=>l.get(e)));await(async(e,t)=>{if(!t)return;const r=await Ta(t.map((({label:t,onTap:n,shouldHide:r,icon:a})=>r?.(e)?null:{label:t,icon:a,value:async()=>{await n(e)}})).filter(n));await(r?.())})(e,i)}else await o(h);O(),g(t)}})},q=f((({rerender:e})=>xr({getEntities:()=>w().allEntityIds,getEntityRow:N,rerenderParent:e,name:h}))),H={selectedEntityIds:new Set,appliedFilters:[],filterBySearchQuery:null};await m({defaultState:H,beforeLoad:()=>g(H),onDismiss:async()=>{await(t?.(p.getData()))},render:()=>[P(),$(),er(),q()]})},Ua=async e=>{const t={sfSymbolKey:e};return await Va({getEntities:()=>T(at).map((([e,t])=>({key:e,value:t}))),getEntityRow:({entity:{key:e},onTap:n})=>{return dn({icon:e,text:(r=e,r.slice(0,1).toUpperCase()+r.slice(1).toLowerCase()),...e===t.sfSymbolKey&&{bgColor:K("selectedBgColor")},onTap:n,borderTop:1,borderBottom:1});var r},getEntityId:({key:e})=>e,openEntity:({entity:{key:e},rerender:n})=>{t.sfSymbolKey=e,n()},getCustomCTAs:()=>{const e=t.sfSymbolKey;return[{text:e?`Selected: ${e}`:"No selection",icon:e??"dot_in_circle",isFaded:!e}]},getSearchMatchPredicate:e=>({key:t,value:n})=>oe(t,e)||oe(n,e),headerOpts:{title:"Icon picker"}}),t.sfSymbolKey};const ja="Cancel",Wa=async(e,{title:r="Select option",onOptionSelect:a,onCancel:o,presentAsSheet:i=!0,...s}={})=>{const l=e.filter(n);if(0===l.length)return null;const c=l.map((e=>[t(e)?e:e.label,{}]));if(0===c.length)return null;const{tappedButtonText:d}=await je({title:r,presentAsSheet:i,...s,buttons:{...p(c),[ja]:{isCancel:!0}}});if(d===ja)return await(o?.()),null;const u=l.find((e=>t(e)?e===d:e.label===d)),h=t(u)?u:u.value;return await(a?.(h)),h},za=e=>0===Object.keys(e).length?"":Object.entries(e).map((([e,t])=>`${e}:${t};`)).join(""),Ka=e=>{if(0===Object.keys(e).length)return"";let t="";for(const[n,r]of Object.entries(e))t+=`${n} {${za(r)}}`;return t},Ya=(e,t={})=>({tagName:e,...t}),Ga=e=>t(e)?e:Qa(e),Ja=e=>{const t=Ga(e);return t?t.split("\n").map((e=>`\t${e}`)).join("\n"):null},Qa=e=>{const{tagName:t,attributes:n={},children:r=[],classList:a=[],id:o,prettify:i,style:s={}}=e,l={...n,...Object.keys(s).length>0&&{style:za(s)},...o&&{id:o},...a.length>0&&{class:a.join(" ")}},c=`<${t} ${Object.entries(l).map((([e,t])=>`${e}="${t}"`)).join(" ")}>`,d=`</${t}>`;if(i){return[c,r.map(Ja).filter(Boolean).join("\n"),d].join("\n")}return r.length>0?[c,...r.map(Ga),d].join(""):`${c}${d}`};const Xa=async(e,t,n=!0)=>{const r=n?to(t,Za):t;await e.loadHTML(r)},Za=["window.addEventListener("," 'click',"," event => {","   const closestLink = event.target && event.target.closest('a');","   if (!closestLink) return;","   event.preventDefault();","   const url = closestLink.getAttribute('href');","   window.location.href = url;"," },"," true",");"].map((e=>e.trim())).join(""),eo=e=>oe(e,"<html")&&oe(e,"</html>")?e:`<html>${e}</html>`,to=(e,t)=>{const n=oe(e,"<head")&&oe(e,"</head>"),r=oe(e,"<html")&&oe(e,"</html>"),a=`<script>${t}<\/script>`,o=`<head>${a}</head>`;return n?eo(((e,t,n,...r)=>{const a=[...e];return a.splice(t,n,...r),a})(e.split("</head>"),1,0,`${a}</head>`).join("")):r?["<html>",`${o}`,se(e,/<html[^<>]*>/i)[1]].join(""):eo([o,e].join(""))};new be({name:"webview passedData$",defaultState:{},showStreamDataUpdateDebug:!1});const no=(e={})=>{const t=(({shouldAllowRequest:e,html:t,url:n,routeLinkClicksThroughWindowLocation:r=!0})=>{const a=new WebView;return e&&(a.shouldAllowRequest=e),t?Xa(a,t,r):n&&a.loadURL(n),a})(e);return{render:({fullscreen:e=!1}={})=>t.present(e),renderThenEvaluateJs:async(e,{fullscreen:n=!1}={})=>(await t.present(n),await t.evaluateJavaScript(e)),evaluateJs:async(e,n=!0)=>await t.evaluateJavaScript(e,n),loadHTML:n=>Xa(t,n,e.routeLinkClicksThroughWindowLocation),setRequestHandler:e=>t.shouldAllowRequest=e}},ro=(e,t)=>Ya("p",{style:t,children:[e]}),ao="resetButton",oo="clearButton",io="buttonContainer",so="pageContainer",lo="onTextAreaChange",co=({label:e,disabled:t,id:n})=>Ya("button",{attributes:{type:"button",...t?{disabled:"true"}:{}},id:n,children:[e]}),uo=({initValue:e})=>co({label:"âˆ…",disabled:!e,id:oo}),ho=({initValue:e,includeClearButton:t,includeResetButton:r})=>Ya("div",{id:io,children:[r&&co({label:"âŽŒ",disabled:!0,id:ao}),t&&uo({initValue:e})].filter(n)}),po=Ya("hr"),go=({placeholder:e,initValue:t})=>Ya("textarea",{attributes:{placeholder:e},children:[t]}),mo=({placeholder:e,dontIncludeResetButton:t,hideAllButtons:n,includeClearButton:r,initValue:a})=>Ya("form",{children:[go({placeholder:e,initValue:a}),ho({initValue:a,includeClearButton:!n&&r,includeResetButton:!n&&!t})]}),fo=(...e)=>Ya("div",{id:so,children:e}),wo=({title:e,message:t})=>{return Ya("div",{children:[e&&(r=2,(e,t)=>Ya(`h${r}`,{style:t,children:[e]}))(e),t&&ro(t),po].filter(n)});var r},bo=e=>`${e}px`,yo={"background-color":`#${K("bg").hex}`,color:`#${K("primaryTextColor").hex}`},Co={padding:bo(10),color:"white","background-color":`#${K("deep_blue_l1").hex}`,"text-align":"center","font-weight":"bold","font-size":bo(26),border:0,"border-radius":bo(4),width:bo(50),height:bo(50)},So={width:"100%",height:"100%","font-size":bo(20),border:0,padding:bo(0),"line-height":"1.5em","white-space":"pre-wrap","margin-top":0},vo={[`div#${so}`]:{display:"flex","flex-direction":"column",height:"100%"},hr:{margin:"20px 0",opacity:.3},[`div#${io}`]:{display:"flex","justify-content":"flex-start","flex-direction":"column",gap:"20px"},button:Co,"button:disabled":{opacity:.4},textarea:So,form:{display:"flex","flex-grow":3},h2:{"margin-bottom":0},p:{margin:"5px 0 0"},"body,textarea":yo},To=async({title:e,onSubmit:t=(()=>{}),message:n,initValue:r="",placeholder:a="Enter text",includeClearButton:o=!1,dontIncludeResetButton:i=!1,hideAllButtons:s=!1}={})=>{const l=(({children:e,pageStyle:t,headJavascript:n,logHTML:r=!1})=>{const a={...t,body:{...t?.body,"font-family":"-apple-system"}},o=Ya("style",{children:[Ka(a)]}),i=Ya("meta",{attributes:{name:"viewport",content:"width=device-width","initial-scale":1,"maximum-scale":1,"user-scalable":0}}),s=n&&Ya("script",{children:[n]}),l=[Ya("head",{children:M([o,i,s])}),Ya("body",{children:e})].map(Qa).join("\n");return r&&console.log(l),l})({pageStyle:vo,headJavascript:(c=r,`\nconst runFnOnElIfExists = (selector, fn) => {\n  const el = document.querySelector(selector);\n  return el ? fn(el) : null;\n};\n\nconst setIsButtonDisabled = (id, isDisabled) =>\n  runFnOnElIfExists('#' + id, el =>\n    isDisabled ? (el.disabled = true) : el.removeAttribute('disabled')\n  );\n\nconst ${lo} = () => {\n  const inputVal = document.querySelector('textarea').value;\n  setIsButtonDisabled('${ao}', inputVal === \`${ie(c)}\`);\n  setIsButtonDisabled('${oo}', !inputVal);\n};\n\nconst setVal = val =>\n  runFnOnElIfExists('textarea', el => {\n    el.value = val;\n    onTextAreaChange();\n  });\n\nconst addListener = (selector, fn, eventType = 'click') =>\n  runFnOnElIfExists(selector, el => el.addEventListener(eventType, fn));\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  addListener('#${ao}', () =>\n    setVal(\`${ie(c)}\`)\n  );\n  addListener('#${oo}', () => setVal(''));\n  addListener('textarea', ${lo}, 'input');\n});\n`),children:[fo(wo({title:e,message:n}),mo({dontIncludeResetButton:i,hideAllButtons:s,includeClearButton:o,initValue:r,placeholder:a}))]});var c;const d=await no({html:l}).renderThenEvaluateJs("document.querySelector('textarea').value");return await t(d),d},{danger:Do}=G(),Eo=({fieldLabel:e,rowOpts:t})=>e?Ft([ln(e,{font:()=>Font.footnote()})],{height:14,paddingTop:10,...t}):null,_o=({valueRowLabel:e,icon:t,fieldLabel:n,showErrorIndicator:r,showClearIndicator:a,rowOpts:o,bgColor:i})=>Ft([ln(e),a&&on("x_in_circle",{width:"10%"}),r&&on("circled_exclamation_filled",{width:"10%",doNotTint:!0}),t&&on(t,{width:"10%"})],{height:37,...o,paddingBottom:r?0:5,paddingTop:n?0:5,bgColor:i}),ko=({rowOpts:{onTap:e},errorMessage:t})=>t&&Ft([ln(t,{color:Do})],{marginBottom:0,height:14,font:()=>Font.footnote(),onTap:e,paddingBottom:10}),xo=({labelOpts:e,valueOpts:t,errorOpts:n})=>{const r=e&&Eo(e),a=ko({...n,isAboveValueRows:!1});return Ft([r,_o({...t,fieldLabel:e?.fieldLabel}),a])},Oo=({labelOpts:e,valueOpts:t,errorOpts:n})=>Ft([Eo(e),ko({...n,isAboveValueRows:!0}),...t.flatMap((e=>_o({...e,showErrorIndicator:!1})))]),Fo=Symbol("NO_FIELD_SECTION"),Io=({errorMessage:e,isRequired:t},n)=>e??(t&&!n?"Required":null),Ro=({mapDisplayValue:e},t)=>(t&&e?.(t))??t,Mo=({isFaded:e,onTap:t,onDoubleTap:n})=>({onTap:t,onDoubleTap:n,isFaded:Boolean(e)}),Po=e=>Ke("Clear value?",{confirmButtonTitle:"Clear",dontShowAgainKey:"form-clear-value",onConfirm:()=>e(void 0)}),Ao=e=>{const{onChange:t,options:n,currValue:r,label:a,customIcon:o}=e,i=Io(e,r),s=Mo({onTap:()=>t($(r,n)),isFaded:!r});return xo({labelOpts:{fieldLabel:a,rowOpts:s},errorOpts:{errorMessage:i,rowOpts:s},valueOpts:{icon:o??"cycle",rowOpts:s,valueRowLabel:Ro(e,r)??"Select option",showErrorIndicator:Boolean(i)}})},Bo=e=>{const{onChange:t,options:n,currValue:r,label:a,size:o="md"}=e,i=Io(e,r);return Oo({labelOpts:{fieldLabel:a,rowOpts:{isFaded:!r}},errorOpts:{errorMessage:i,rowOpts:{}},valueOpts:n.map((n=>{const a=n===r;return{icon:a?"circle_filled":"circle",rowOpts:{onTap:()=>t(n),isFaded:!a},size:o,valueRowLabel:Ro(e,String(n))}}))})},Lo=e=>{const{currValue:t,onChange:n,label:r}=e,a=Io(e,t),o=Mo({onTap:()=>n(!t),isFaded:!t});return xo({errorOpts:{errorMessage:a,rowOpts:o},valueOpts:{icon:t?"task_complete":"task_incomplete",rowOpts:o,valueRowLabel:Ro(e,r),showErrorIndicator:Boolean(a)}})},$o=e=>{const{label:t,currValue:n,onChange:r}=e,a=Io(e,n),o=Mo({isFaded:!n,onTap:async()=>{const e=await Ua(n);e&&e!==n&&r(e)}});return xo({labelOpts:{fieldLabel:t,rowOpts:o},errorOpts:{errorMessage:a,rowOpts:o},valueOpts:{icon:n,rowOpts:o,showErrorIndicator:Boolean(a),valueRowLabel:Ro(e,n)??"Select icon"}})},No=e=>{const{onChange:t,currValue:n,customIcon:r,label:a,isClearable:o}=e,i=Boolean(n&&o),s=Mo({onTap:async()=>{const e=await Ca();e&&e.label!==n?.label&&t(e)},isFaded:!n,...i&&{onDoubleTap:()=>Po(t)}}),l=Io(e,n);return xo({labelOpts:{fieldLabel:a,rowOpts:s},errorOpts:{errorMessage:l,rowOpts:s},valueOpts:{icon:r,rowOpts:s,valueRowLabel:Ro(e,n?.label)??"Choose color",showErrorIndicator:Boolean(l),showClearIndicator:i,bgColor:n?.color}})},qo=e=>{const{onChange:t,currValue:n,customIcon:r,label:a,isClearable:o}=e,i=Boolean(n&&o),s=Mo({onTap:async()=>{const e=await da(a??"Enter text",{initValue:n,placeholder:n});e&&e!==n&&t(e)},isFaded:!n,...i&&{onDoubleTap:()=>Po(t)}}),l=Io(e,n);return xo({labelOpts:{fieldLabel:a,rowOpts:s},errorOpts:{errorMessage:l,rowOpts:s},valueOpts:{icon:r,rowOpts:s,valueRowLabel:Ro(e,n)??"Add text",showErrorIndicator:Boolean(l),showClearIndicator:i}})},Ho=e=>{const{onChange:t,currValue:n,customIcon:r,label:a}=e,o=Mo({isFaded:!n,onTap:async()=>{const e=await To({title:a??"Enter text",initValue:n,placeholder:n,includeClearButton:!0});e&&e!==n&&t(e)}}),i=Io(e,n);return xo({labelOpts:{fieldLabel:a,rowOpts:o},errorOpts:{errorMessage:i,rowOpts:o},valueOpts:{icon:r,rowOpts:o,valueRowLabel:Ro(e,n)??"Add text",showErrorIndicator:Boolean(i)}})},Vo=e=>{const{customIcon:t,label:n,currValue:r,onChange:a}=e,o=Mo({onTap:async()=>{const e=await pt(r?{initialDate:fe(r)}:{});if(!e)return;const t=ge(e,"YYYYMMDD");t!==r&&a(t)},isFaded:!r}),i=Io(e,r);return xo({labelOpts:{fieldLabel:n,rowOpts:o},errorOpts:{errorMessage:i,rowOpts:o},valueOpts:{icon:t,rowOpts:o,valueRowLabel:Ro(e,r)??"Select date",showErrorIndicator:Boolean(i)}})},Uo=e=>{if(!e)return"Select date";return`${((e,t=!1)=>((e,t)=>{switch(e){case 0:return t?"Tod.":"Today";case 1:return t?"Tom.":"Tomorrow";case-1:return t?"Yest.":"Yesterday";default:return null}})(ce(le(e),le()),t))(e)||ge(e,"YYYYMMDD")}, ${ge(e,"HHMM")}`},jo=e=>{const{onChange:t,currValue:n,customIcon:r,label:a}=e,o=Mo({onTap:async()=>{const e=await gt(n??void 0);e&&e.getTime()!==n?.getTime()&&t(e)},isFaded:!n}),i=Io(e,n);return xo({labelOpts:{fieldLabel:a,rowOpts:o},errorOpts:{errorMessage:i,rowOpts:o},valueOpts:{icon:r,rowOpts:o,valueRowLabel:Uo(n),showErrorIndicator:Boolean(i)}})},Wo=e=>{const{onChange:t,selectedOptions:n,label:r,options:a}=e,o=n.length>0,i=Io(e,o);return Oo({labelOpts:{fieldLabel:r,rowOpts:{isFaded:!o}},errorOpts:{errorMessage:i,rowOpts:{}},valueOpts:a.map((r=>{const a=n.includes(r);return{icon:a?"task_complete":"task_incomplete",rowOpts:{onTap:(o=r,()=>t(R(n,o))),isFaded:!a},valueRowLabel:Ro(e,String(r))};var o}))})},zo=`${re.ADD} Custom`,Ko=e=>{const{currValue:t,label:r,isClearable:a,onChange:o}=e,i=Boolean(t&&a),s=Mo({isFaded:!t,onTap:()=>(async e=>{const{onChange:t,options:r,currValue:a,label:o,allowCustom:i}=e,s=[...r,a].filter(n).map((t=>{const n=Ro(e,String(t));return{label:`${t===a?`${re.CHECKMARK_GREEN} `:""}${n}`,value:t}})),l=i?{label:zo,value:zo}:null,c=await Wa([...s,l],{title:o??"Select option"});if(c&&c!==a)if(c!==zo)t(c);else{const e=await da("Custom response");e&&t(e)}})(e),...i&&{onDoubleTap:()=>Po(o)}}),l=Io(e,t);return xo({labelOpts:{fieldLabel:r,rowOpts:s},errorOpts:{errorMessage:l,rowOpts:s},valueOpts:{icon:"expand_vertical_2",rowOpts:s,valueRowLabel:Ro(e,t)??"Select option",showErrorIndicator:Boolean(l),showClearIndicator:i}})},Yo=e=>{const{label:t,customIcon:n,value:r,onTap:a}=e,o={onTap:a};return xo({labelOpts:{fieldLabel:t,rowOpts:o},valueOpts:{icon:n,rowOpts:o,valueRowLabel:Ro(e,r)},errorOpts:{errorMessage:null,rowOpts:o}})},Go=t=>{const{onChange:n,currValue:r,customIcon:a,label:o}=t,i=Mo({onTap:async()=>{const t=await da("Enter number",{flavor:"number",...e(r)&&{initValue:String(r)},placeholder:e(r)?String(r):"42"}),a=t&&Number.parseInt(t);e(a)&&a!==r&&n(a)},isFaded:!e(r)}),s=Io(t,r);return xo({labelOpts:{fieldLabel:o,rowOpts:i},errorOpts:{errorMessage:s,rowOpts:i},valueOpts:{icon:a,rowOpts:i,valueRowLabel:Ro(t,e(r)?String(r):null)??"Enter number",showErrorIndicator:Boolean(s)}})},Jo=D({allowCustom:null,customIcon:null,errorMessage:null,isClearable:null,isRequired:null,label:null,mapDisplayValue:null});const Qo=e=>S(e,Jo),Xo=e=>e.every((e=>t(e)||Number.isFinite(e))),Zo={checkbox:e=>{const{label:t,currValue:n,onChange:r}=e;if(!t)throw new Error("Checkbox requires label");return[Lo({...Qo(e),label:t,currValue:n,onChange:r}),At()].flat()},cycle:e=>{const{options:n,currValue:r,onChange:a}=e;if(!n)throw new Error("Cycle requires options");if(void 0===r)throw new Error("Cycle value must be a string or null");if(!n.every((e=>t(e)||null===e)))throw new Error("Cycle options must be only string or null");return[Ao({...Qo(e),onChange:a,options:n,currValue:r}),At()].flat()},chooseIcon:e=>{const{currValue:t,onChange:n}=e;return[$o({...Qo(e),currValue:t,onChange:n}),At()].flat()},textInput:e=>{const{currValue:t,onChange:n}=e;return[qo({...Qo(e),currValue:t,onChange:n}),At()].flat()},textarea:e=>{const{currValue:t,onChange:n}=e;return[Ho({...Qo(e),currValue:t,onChange:n}),At()].flat()},YYYMMDDDatePicker:e=>{const{currValue:t,onChange:n}=e;return[Vo({...Qo(e),currValue:t,onChange:n}),At()].flat()},dateAndTimePicker:e=>{const{currValue:t,onChange:n}=e;return[jo({...Qo(e),currValue:t,onChange:n}),At()].flat()},selectMulti:e=>{const{onChange:t,currValue:n,options:r,label:a}=e;if(!(n&&r&&a))throw new Error("SelectMulti requires options, default selection, and label.");if(!Xo(r))throw new Error("SelectMulti options must be only string or number");return[Wo({...Qo(e),selectedOptions:n,options:r,label:a,onChange:t}),At()].flat()},radio:e=>{const{onChange:t,currValue:n,options:r,label:a}=e;if(!r||!a)throw new Error("Radio requires options and label.");if(!Xo(r))throw new Error("Radio options must be only string or number");return[Bo({...Qo(e),onChange:t,options:r,currValue:n,label:a}),At()].flat()},dropdown:e=>{const{currValue:t,onChange:n,options:r}=e;if(!r)throw new Error("Dropdown requires options.");if(!Xo(r))throw new Error("Dropdown options must be only string or number");return[Ko({...Qo(e),onChange:n,currValue:t,options:r}),At()].flat()},readonly:e=>{const{currValue:t}=e;if(!t)throw new Error("Readonly field requires a current value.");return[Yo({...Qo(e),value:t}),At()].flat()},color:e=>{const{currValue:t,onChange:n}=e;return[No({...Qo(e),currValue:t,onChange:n}),At()].flat()},numberValue:e=>{const{currValue:t,onChange:n}=e;return[Go({...Qo(e),currValue:t,onChange:n}),At()].flat()}};var ei=e=>{const{connect:n,present:a,getState:o,setState:i}=Vn({name:"form"}),s=t=>r(e)?e(t):e,l=n((({state:{formState:e}})=>{const{title:t,subtitle:n}=s(e);return wr({title:t,subtitle:n})})),c=n(((e,n,r)=>[t(n)&&br({label:n,marginTop:20}),At(),...r.flatMap((([e,t])=>((e,{type:t,getErrorMessage:n,isClearable:r=!1,shouldHide:a,...l})=>{const{formState:c}=o();if(a?.(c))return null;const d=Zo[t],u=n?.(c);return d({currValue:c[e],onChange:t=>{if(!r&&((e,t,n=((e,t)=>e===t))=>[null,void 0].some((t=>n(e,t))))(t))return;const{formState:n}=o(),a={...n,[e]:t},l=s(a).onStateChange?.(a,n)??a;i({formState:l})},isClearable:r,...u&&{errorMessage:u},...l})})(e,t)))].flat())),d=n((({state:{formState:e}})=>{const{fields:n}=s(e),{noSectionFields:r,sectionFields:a}=(e=>{const n=((e,t,n)=>{let r=[];for(const a of e){const e=t(a),o=n?n(a):a;let i=!1;const s=r.map((t=>t.key!==e?t:(i=!0,{key:e,val:[...t.val,o]})));i||s.push({key:e,val:[o]}),r=s}return r})(e,(([e,{section:t}])=>t??Fo));return m(n,{noSectionFields:e=>!t(e.key),sectionFields:e=>t(e.key)})})(T(n));return M([(o=r,o.length>0&&c(Fo,r[0].val)),...a.flatMap((({key:e,val:t})=>c(e,t)))]).flat();var o})),u=n((({state:{formState:e}})=>{const{isFormValid:t,onSubmit:n,submitButtonText:r="Save"}=s(e),a=!t||t(e);return gn({...zt().flavors.primary,text:r,icon:"checkmark",isDisabled:!a,dismissOnTap:!0,isLarge:!0,onTap:()=>{i({didSubmit:!0}),n?.(e)}})}));return async(e={})=>{const{formState:t,didSubmit:n}=await a({shouldPreloadIcons:!0,defaultState:{formState:e,didSubmit:!1},loadProps:()=>({initState:e}),render:()=>[l(),er(),d(),er(),er(),u()]});return{formState:t,isValid:s(t).isFormValid?.(t)??null,submitted:n,cancelled:!n}}};const ti={largeTitle:()=>Font.largeTitle(),title1:()=>Font.title1(),title2:()=>Font.title2(),title3:()=>Font.title3(),headline:()=>Font.headline(),subheadline:()=>Font.subheadline(),body:()=>Font.body(),callout:()=>Font.callout(),footnote:()=>Font.footnote(),caption1:()=>Font.caption1(),caption2:()=>Font.caption2()},ni=D(ti),ri={System:{100:e=>Font.ultraLightSystemFont(e),200:e=>Font.thinSystemFont(e),300:e=>Font.lightSystemFont(e),400:e=>Font.regularSystemFont(e),500:e=>Font.mediumSystemFont(e),600:e=>Font.semiboldSystemFont(e),700:e=>Font.boldSystemFont(e),800:e=>Font.heavySystemFont(e),900:e=>Font.blackSystemFont(e)},Monospaced:{100:e=>Font.ultraLightMonospacedSystemFont(e),200:e=>Font.thinMonospacedSystemFont(e),300:e=>Font.lightMonospacedSystemFont(e),400:e=>Font.regularMonospacedSystemFont(e),500:e=>Font.mediumMonospacedSystemFont(e),600:e=>Font.semiboldMonospacedSystemFont(e),700:e=>Font.boldMonospacedSystemFont(e),800:e=>Font.heavyMonospacedSystemFont(e),900:e=>Font.blackMonospacedSystemFont(e)},Rounded:{100:e=>Font.ultraLightRoundedSystemFont(e),200:e=>Font.thinRoundedSystemFont(e),300:e=>Font.lightRoundedSystemFont(e),400:e=>Font.regularRoundedSystemFont(e),500:e=>Font.mediumRoundedSystemFont(e),600:e=>Font.semiboldRoundedSystemFont(e),700:e=>Font.boldRoundedSystemFont(e),800:e=>Font.heavyRoundedSystemFont(e),900:e=>Font.blackRoundedSystemFont(e)}},ai=({family:e,size:t,weight:n=400})=>{const r=ri[e][n];return t?r(t):r},oi=e=>e?Font.italicSystemFont(e):e=>Font.italicSystemFont(e),ii=e=>ti[e],si=["System","Monospaced","Rounded"],{getState:li,setState:ci,present:di}=Vn({name:"chooseFontFamily"}),ui=(e,t)=>{const n=li().selection===e;return Ft([ln(e,{font:t,fontSize:30}),n&&on("checkmark",{width:"5%"})],{onTap:()=>ci({selection:e}),dismissOnTap:!0,borderTop:1,borderBottom:1,height:50,paddingTop:10,paddingBottom:10})},hi=(e,t,n)=>{const r=zt().flavors.secondary.bgColor;return Mt([Ft([Dn(`${e}:`)],{bgColor:r}),...t,Lt({from:r,mode:"DOWN",stepOptions:{stepRowHeight:3}})],{paddingTop:10,bgColor:r,...!n&&{marginTop:30}})};const{getState:pi,setState:gi,present:mi}=Vn({name:"font viewer"}),fi=e=>ni.includes(e),wi=Ze(),bi=et(pi,gi),yi=bi(wi((e=>({...e,size:e.size+1})))),Ci=bi(wi((e=>({...e,size:e.size-1})))),Si=bi(wi((e=>({...e,weight:900===e.weight?900:e.weight+100})))),vi=bi(wi((e=>({...e,weight:100===e.weight?100:e.weight-100})))),Ti=bi((async e=>{const t=await(async e=>{const{selection:t}=await di({defaultState:{selection:e??null},render:()=>[hi("Font families",[...si.map((e=>ui(e,ai({family:e})))),ui("Italic",oi())],!0),hi("Static fonts",ni.map((e=>ui(e,ii(e)))))]});return t})(e);return e=>({...e,...t&&{fontSelection:t}})})),Di=()=>{const{size:e,weight:t,fontSelection:n}=pi();return In({containerStyle:{marginTop:0},columns:{Font:{width:"50%"},Size:{},Weight:{}},rows:[{cellValues:{Font:n??"None",Size:n?fi(n)?"Static":String(e):"",Weight:n?fi(n)||"Italic"===n?"N/A":String(t):""}}]})},Ei=()=>{const{size:e,weight:t,fontSelection:n}=pi(),r=n?"Italic"===n?oi():fi(n)?ii(n):ai({family:n,weight:t}):ai({family:"System",weight:t});return Ft([ln("The quick brown fox jumps over the lazy dog. THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG. 0123456789!@#$%^&*()",{font:r,fontSize:e})],{borderTop:1,borderBottom:1,height:150,bgColor:zt().flavors.secondary.bgColor,onTap:()=>Ti(n)})},_i=({direction:e,increment:t,isDisabled:n})=>Ft([on("DOWN"===e?"chevron_down":"chevron_up")],{height:30,borderTop:1,borderBottom:1,isFaded:n,onTap:()=>!n&&t(),paddingTop:15,paddingBottom:15}),ki=()=>{const{weight:e,fontSelection:t}=pi();return t?fi(t)||"Italic"===t?null:Mt([En("Weight"),_i({direction:"UP",increment:Si,isDisabled:900===e}),_i({direction:"DOWN",increment:vi,isDisabled:100===e})]):null},xi=()=>{const{size:e,fontSelection:t}=pi();return t?fi(t)?null:Mt([En("Size"),_i({direction:"UP",increment:yi}),_i({direction:"DOWN",increment:Ci,isDisabled:1===e})]):null};new be({name:"robustCleanup$",defaultState:{status:"READY",numFailures:0,numRemainingTmpFiles:0,numDownloaded:0,numRemoved:0}});const Oi=e=>Vn({name:UUID.string()}).present({render:()=>[e]}),Fi=({label:e,type:t})=>ei({title:"My form",fields:{val:{type:t,label:e}}})(),Ii=(e,t,n)=>Mt([e],{marginTop:n,marginBottom:t}),Ri={input:{description:"Elements used for user input",children:{chooseColor:{showPreview:Ca},chooseFont:{showPreview:async()=>{const{fontSelection:e,size:t,weight:n}=await mi({defaultState:{size:16,weight:400},render:()=>[Dn("Font viewer"),Di(),Ei(),ki(),xi()]});return e?"Italic"===e?oi(t):fi(e)?ii(e):ai({family:e,size:t,weight:n}):null}},chooseSFSymbol:{showPreview:Ua},confirm:{description:"Dialog to prompt user to confirm an action",showPreview:()=>ze("Confirm this action?",{message:"An optional message to accompany the title"})},destructiveConfirm:{description:"Similar to confirm, but with a red confirmation button",showPreview:()=>Ke("Delete this widget?",{message:"Optional message goes here"})},OK:{description:"Simple dialog to acknowledge a message",showPreview:()=>Ye("Uh-oh!",{message:"Something went wrong. Try again later."})},"Date input":{description:"Prompt for dates",children:{pickDate:{description:"Simple date picker using system UI",showPreview:pt},pickDateAndTime:{description:"Simple date picker using system UI",showPreview:gt},pickRelativeDate:{description:"Custom UI to select dates relative to today",showPreview:()=>(async(e={})=>{const{initialDate:t,onSubmit:n=(()=>{}),onCancel:r=(()=>{})}=e,a=await Pr({defaultState:{startDate:le(t||new Date),chosenDate:null,useDatePicker:!1,useSpecificDateTimePicker:!1},loadProps:()=>(({title:e="Select date",daysToInclude:t=9,...n})=>({title:e,daysToInclude:t,...n}))(e),render:()=>[Hr(),Vr(),Wr(),Yr(),zr()]}),o=await Gr(a,e);return await(o?n(o):r()),o})({allowTimeSelection:!0,message:"Which date works for you?"})}}},"Form input":{children:{form:{description:"A self-contained form component with validation",showPreview:()=>ei({title:"Sample form",subtitle:"Form can not be submitted until validation is satisfied",isFormValid:({title:e,value:t})=>Boolean(e&&t),fields:{title:{type:"textInput",label:"Title",isRequired:!0},value:{type:"numberValue",label:"Numerical value",isRequired:!0},date:{type:"YYYMMDDDatePicker",label:"Date in YYYY-MM-DD format"},color:{type:"color",label:"Favorite color"}}})()},Checkbox:{showPreview:()=>Fi({label:"Selected?",type:"checkbox"})},ChooseColor:{showPreview:()=>Fi({label:"Color",type:"color"})},ChooseIcon:{showPreview:()=>Fi({label:"Icon",type:"chooseIcon"})},Cycle:{description:"Cycle between options",showPreview:()=>ei({title:"My form",fields:{val:{type:"cycle",label:"Value",options:["A","B","C"]}}})({val:"A"})},DateAndTimePicker:{showPreview:()=>Fi({label:"Duedate",type:"dateAndTimePicker"})},Dropdown:{showPreview:()=>ei({title:"My form",fields:{val:{type:"dropdown",label:"Value",options:["A","B","C"],allowCustom:!0}}})()},Number:{showPreview:()=>Fi({label:"Number",type:"numberValue"})},Radio:{showPreview:()=>ei({title:"My form",fields:{val:{type:"radio",label:"Value",options:["A","B","C"]}}})()},SelectMulti:{showPreview:()=>ei({title:"My form",fields:{val:{type:"selectMulti",label:"Value",options:["A","B","C"]}}})({val:[]})},TextArea:{showPreview:()=>Fi({label:"TextArea",type:"textarea"})},TextInput:{showPreview:()=>Fi({label:"TextInput",type:"textInput"})},YYYYMMDDDatePicker:{showPreview:()=>Fi({label:"Date",type:"YYYMMDDDatePicker"})}}},listChoose:{description:"Select from a list of options",showPreview:()=>(async(e,{onOptionSelect:t,onCancel:n,...r}={})=>{const a=[{label:Da,value:Da,icon:"add",flavor:"serene"},...e],o=await Ta(a,r);if(!o)return n?.(),null;if(o!==Da)return await(t?.(o)),o;const i=await da("Custom response");return await(i?t?.(i):n?.()),i??null})(["First option","Second option","Third option"],{fallbackIcon:"task_incomplete",onOptionSelect:e=>A(`Selected: ${e}`)})},quickOptions:{description:"Like listChoose, but using the iOS interface",showPreview:()=>Wa(["First option","Second option","Third option"],{message:"Put your own message here",title:"You must choose!",onOptionSelect:e=>A(`Selected: ${e}`)})},textArea:{description:"Fullscreen text input box",showPreview:(()=>{let e="";return()=>To({includeClearButton:!0,initValue:e,onSubmit:t=>e=t,title:"textArea",message:"A fullscreen text input option",placeholder:"Buttons on the right allow you to reset or clear the text"})})()},textInput:{description:"Regular text input",showPreview:(()=>{let e="";return()=>da("textInput",{initValue:e??void 0,onSubmit:t=>e=t,message:"Text input for shorter entries",placeholder:"Feed me text, nom"})})()}}},UITable:{description:"Elements used in UI tables",children:{Button:{description:"Call to action button",showPreview:()=>Oi(Ft([Ii(gn({text:"Primary button",icon:"checkmark",flavor:"primary",marginTop:10}),10,10),Ii(gn({text:"Large primary button",icon:"checkmark",flavor:"primary",marginTop:10,isLarge:!0}),10),Ii(gn({text:"Default button",icon:"checkmark"}),10),Ii(gn({text:"Danger button",icon:"checkmark",flavor:"danger"}),10),Ii(gn({text:"Warning button",icon:"checkmark",flavor:"warning"}),10),Ii(gn({text:"Happy button",icon:"checkmark",flavor:"happy"}),10)]))},DetailCard:{description:"A card that can be used to show details of some item",showPreview:()=>Oi(Ft([Cn({title:"Card 1",titleIcon:"go_forward",containerStyle:{borderTop:1,borderBottom:1},details:[{text:"A fact",icon:"person"},{text:"Another fact",icon:"tag"}]}),Cn({title:"Card 2",titleIcon:"go_forward",containerStyle:{borderTop:1,borderBottom:1},details:[{text:"A fact",icon:"person"},{text:"Another fact",icon:"tag"}]})]))},H1:{showPreview:()=>Oi([Dn("The table title"),Dn("With customization",{icon:"edit",subtitle:"A subtitle here, with custom color",subtitleColor:Color.blue()})])},H2:{showPreview:()=>Oi([En("A slightly smaller header"),En("An H2 with an optional icon",{icon:"expand"})])},P:{description:"Paragraph text",showPreview:()=>Oi(Ft([ln("Hello there, here is my paragraph text. I've increased the height so that you can see more text.")],{height:100}))},ProgressBar:{description:"Visualize the progress of some process",showPreview:()=>Oi([Dn("Progress bar",{subtitle:"Progress bar showing 40% completion"}),kn(.4)])},ThreeCol:{description:"A row with an icon, main text, and some (optional) metadata",showPreview:()=>Oi(dn({icon:"undo",text:"This is the main text",metadata:4}))},Table:{description:"Display table data within a UI table",showPreview:()=>Oi(In({columns:{"Column A":{isRowValueBold:!0},"Column B":{},"Column C":{}},rows:[{cellValues:{"Column A":"Alpha","Column B":"Bravo","Column C":"Charlie"}},{cellValues:{"Column A":"Delta","Column B":"Echo","Column C":"Foxtrot"}},{cellValues:{"Column A":"Golf","Column B":"Hotel","Column C":"India"}},{cellValues:{"Column A":"Juliett","Column B":"Kilo","Column C":"Lima"}},{cellValues:{"Column A":"Mike","Column B":"November","Column C":"Oscar"}},{cellValues:{"Column A":"Papa","Column B":"Quebec","Column C":"Romeo"}},{cellValues:{"Column A":"Sierra","Column B":"Tango","Column C":"Uniform"}},{cellValues:{"Column A":"Victor","Column B":"Whiskey","Column C":"Xray"}},{cellValues:{"Column A":"Yankee","Column B":"Zulu","Column C":""}}]}))},Toast:{description:"An alert banner with various flavors",showPreview:()=>Oi([Mt([Mn({title:"Default toast",icon:"calendar",showCloseIcon:!0,metadata:10,description:"More information can go here"})],{marginTop:10}),Mn({title:"Primary toast",icon:"calendar",showCloseIcon:!0,metadata:10,flavor:"primary"}),Mn({title:"Danger toast",icon:"calendar",showCloseIcon:!0,flavor:"danger"}),Mn({title:"Warning toast",icon:"calendar",showCloseIcon:!0,metadata:10,flavor:"warning"}),Mn({title:"Happy toast",icon:"calendar",flavor:"happy"})])}}}},Mi=An({borderTop:1,borderBottom:1,paddingTop:10,paddingBottom:10}),Pi=Pn({font:ai({family:"System",weight:600})}),Ai=e=>"children"in e.val,Bi=(({getValue:e,shouldRaiseA:t,shouldRaiseB:n})=>(r,a)=>{const o=e(r),i=e(a);return t(o,i)?-1:n?n(o,i)?1:0:1})({getValue:e=>e,shouldRaiseA:Ai}),Li=(e,t)=>{const{present:n}=Vn({name:`storybook_${e}`}),r=T(t).map((([e,t])=>({title:e,val:t})));return n({render:()=>[Dn(e),Ft(r.sort(Bi).map((e=>Ai(e)?(({title:e,val:t,onSelectChild:n})=>Mi([Pi([ln(e),on("folder",{width:"10%"})]),t.description&&Ft([ln(t.description,{font:()=>Font.footnote()})],{height:14})],{onTap:()=>n(t.children),borderTop:1,borderBottom:1}))({...e,onSelectChild:t=>Li(e.title,t)}):(({title:e,val:{description:t,showPreview:n}})=>Mi([Pi([ln(e),on("open_external",{width:"10%"})]),t&&Ft([ln(t,{font:()=>Font.footnote()})],{height:14})],{onTap:n,borderTop:1,borderBottom:1}))(e))))]})};class $i{constructor(){this.fileManager=FileManager.iCloud()||FileManager.local(),this.documentsDirectory=this.fileManager.documentsDirectory()}async readJSON(e){try{if(await this.ensureExists(e)){const t=this.fileManager.readString(e),n=JSON.parse(t);if(void 0===n)return;return n}}catch(e){throw this.handleError(e)}}async saveJSON(e,t,n){try{const r=JSON.stringify(t,null,2);if(await this.createDirectoryFromFilePath(e),!n)return this.fileManager.writeString(e,r),r;const a=this.fileManager.fileName(e),o=this.fileManager.fileExtension(e),i=n(a)+o,s=e.replace(o,i);return this.fileManager.writeString(s,r),r}catch(e){throw this.handleError(e)}}joinDocumentPaths(e,t){let n;if(n="string"==typeof e?this.fileManager.joinPath(this.documentsDirectory,e):e.reduce(((e,t)=>this.fileManager.joinPath(e,t)),this.documentsDirectory),t){n+=t.startsWith(".")?t:`.${t}`}return n}async createDirectoryFromFilePath(e,t=!0){if(await this.ensureExists(e))return e;const n=this.fileManager.fileName(e,!0),r=e.replace(n,"").replace(this.documentsDirectory,"");return await this.createDirectory(r,t),e}async createDirectory(e,t){try{const n=this.fileManager.joinPath(this.documentsDirectory,e);if(await this.ensureExists(n)){if(this.fileManager.isDirectory(n))return n;throw new Error("A file with the same name already exists.")}return this.fileManager.createDirectory(n,t),n}catch(e){throw this.handleError(e)}}async ensureExists(e){if(!this.fileManager.fileExists(e))return!1;if(this.fileManager.isFileDownloaded(e)||await this.fileManager.downloadFileFromiCloud(e),this.fileManager.isFileDownloaded(e))return!0;throw new Error("Unable to download file.")}handleError(e){return e instanceof Error?new Error(e.message):new Error(String(e))}}(async()=>{const e=new $i;await e.createDirectory("store/img/sfsymbols",!0),await Li("Storybook",Ri)})();
