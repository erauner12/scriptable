// Variables used by Scriptable.
// These must be at the very top of the file. Do not edit.
// icon-color: deep-green; icon-glyph: mosque;
function t(t,e,n,i){return new(n||(n=Promise))((function(o,a){function r(t){try{d(i.next(t))}catch(t){a(t)}}function s(t){try{d(i.throw(t))}catch(t){a(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}d((i=i.apply(t,e||[])).next())}))}function e(e){return t(this,void 0,void 0,(function*(){let t=FileManager.iCloud();if(t.fileExists(e)){t.isFileDownloaded(e)||(yield t.downloadFileFromiCloud(e));const n=t.readString(e);return JSON.parse(n)}return[]}))}function n(t,e,n){const i=function(t,e){let n=t.includes("?");for(const i in e)if(e.hasOwnProperty(i)){const o=e[i];null!=o&&(t+=(n?"&":"?")+encodeURIComponent(i)+"="+encodeURIComponent(o.toString()),n=!0)}return t}(`${t}${o(e)}`,n);return encodeURI(i)}function i(t){const[e,n,i]=t.split("-"),o=new Date(Number(i),Number(n)-1,Number(e));return o.setHours(0,0,0,0),o}function o(t){const e=t||new Date;return new Date(e).toLocaleString(void 0,{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}function a(t,e={hour:"numeric",minute:"numeric",hour12:!0}){return t.toLocaleTimeString(void 0,e).toUpperCase()}function r(e){return t(this,void 0,void 0,(function*(){const t=new Request(e);return yield t.loadJSON()}))}function s(n,o,a){return t(this,void 0,void 0,(function*(){const t=a,r=yield e(n),s=[];(function(t){const e=[];return t.forEach((t=>{e.some((e=>JSON.stringify(e)===JSON.stringify(t)))||e.push(t)})),e})(r).filter((({date:{gregorian:{date:t}}})=>{const e=new Date;e.setHours(0,0,0,0);const n=new Date(e);n.setDate(e.getDate()+o);const a=i(t)>=e,r=i(t)<=n;return a&&r})),t.forEach((t=>{if(!1===s.some((e=>JSON.stringify(e)===JSON.stringify(t)))){const e=s.findIndex((({date:{gregorian:{date:e}}})=>t.date.gregorian.date===e));e>=0&&(s[e]=t),-1===e&&s.push(t)}})),s.sort(((t,e)=>{const n=new Date(t.date.gregorian.date),i=new Date(e.date.gregorian.date);return n<i?-1:n>i?1:0})),function(t,e){let n=FileManager.iCloud(),i=JSON.stringify(e,null,2);n.writeString(t,i)}(n,s)}))}function d(t,e,n){const i=new Date,o=e.map((t=>t.name.toUpperCase()));let a=t.map((t=>function(t){const{timings:e,date:{gregorian:n}}=t,i=n.date.split("-"),o=`${i[2]}-${i[1]}-${i[0]}`;return Object.entries(e).map((([t,e])=>{const n=e.split(":");return{prayer:t,dateTime:new Date(`${o}T${n[0]}:${n[1]}:00`)}}))}(t))).flat().filter((t=>o.includes(t.prayer.toUpperCase()))).filter((t=>t.dateTime>i)).sort(((t,e)=>t.dateTime.getTime()-e.dateTime.getTime()));return n&&(a=a.slice(0,n)),a}function c(t,e,n,i,r){const s=function(t){const e=new Date,n=new Date(new Date(e).setHours(0,0,0,0)),i=new Date(n.getTime()+864e5-1),o=t.findIndex((t=>t.dateTime>e));return t.map(((t,n)=>{let a="unknown",r=!1;return a=t.dateTime<e?"past":t.dateTime>e&&t.dateTime<=i?"today":"future",n===o&&(r=!0),{prayer:t.prayer,dateTime:t.dateTime,status:{state:a,next:r}}}))}(d(t,e,n)),c=new Date,l="#FFFFFF",f=new ListWidget;f.setPadding(16,20,16,20),f.spacing=4;const g=f.addStack();g.layoutVertically(),g.centerAlignContent(),g.spacing=4,s.forEach((t=>{const{prayer:n,dateTime:o}=t,r=function(t,e){const n=new Date(t),i=(new Date(e).getTime()-n.getTime())/864e5;return Math.abs(i)}(c,o)+1,s=new Color(l,.8/r),d=e.find((t=>t.name.toLowerCase()===n.toLowerCase()));if(d){const{name:e,abbreviation:n}=d,o="medium"===i||"large"===i?e.toUpperCase():n;!function(t,e,n,i,o,r){const{dateTime:s,status:d}=n,c=a(s),u=14;let l,f=new Font("AvenirNext-Regular",12);d&&"future"===d.state&&(l=r);d&&d.next&&(f=new Font("AvenirNext-Bold",u));const g=t.addStack();g.spacing=i,g.centerAlignContent();const m=g.addText(e);m.font=f,m.lineLimit=1,g.addSpacer(void 0);let p=c;const y=g.addText(p);y.font=f,y.lineLimit=1,l&&(m.textColor=l,y.textColor=l)}(g,o,t,4,0,s)}}));const m=f.addStack();m.layoutVertically();const p=u(m,`${r} metres`);p.font=new Font("AvenirNext-Regular",10),p.textColor=new Color(l,.8);const y=u(m,`${o(c)} ${a(c)}`);return y.font=new Font("AvenirNext-Regular",10),y.textColor=new Color(l,.8),f}function u(t,e){const n=t.addStack();n.addSpacer();const i=n.addText(e);return i.lineLimit=1,n.addSpacer(),i}"function"==typeof SuppressedError&&SuppressedError;const l={widget:{settings:{file:"Prayer Time",directory:"Prayer Time",size:"small",offline:5},display:{prayerTimes:[{name:"fajr",display:"ðŸŒ„",abbreviation:"FAJ"},{name:"dhuhr",display:"ðŸ•›",abbreviation:"DHU"},{name:"asr",display:"ðŸŒž",abbreviation:"ASR"},{name:"maghrib",display:"ðŸŒ†",abbreviation:"MAG"},{name:"isha",display:"ðŸŒ™",abbreviation:"ISH"},{name:"imsak",display:"â­",abbreviation:"IMS"}]}},api:{endpoint:"https://api.aladhan.com/v1/timings/",location:{latitude:0,longitude:0}}};t(void 0,void 0,void 0,(function*(){try{yield function(){return t(this,void 0,void 0,(function*(){const{widget:{settings:{directory:o,file:a,offline:u},display:{prayerTimes:f}},api:{location:g}}=l,m=1e3,p=config.widgetFamily?config.widgetFamily:"small";let y=5;"large"===p&&(y=14);const h=function(t,e){const n=`${t}.json`,i=e,o=FileManager.iCloud(),a=o.joinPath(o.documentsDirectory(),i);return o.fileExists(a)||o.createDirectory(a),o.joinPath(a,n)}(a,o);let w=0;if(yield function(){return t(this,void 0,void 0,(function*(){const t=new Request("https://www.google.com");t.method="HEAD",t.timeoutInterval=.25;try{return!!(yield t.load())}catch(t){return!1}}))}()){const o=new Date,a=yield e(h),c=function(t,e){const n=t.filter((({date:{gregorian:{date:t}}})=>{const n=e||new Date;n.setHours(0,0,0,0);const o=i(t);return n.toDateString()===o.toDateString()}));if(n[0])return n[0]}(a,o),p=d(a,f).length,{latitude:v,longitude:D}=yield function(e){return t(this,void 0,void 0,(function*(){return yield Location.current()}))}();if(l.api.location.latitude=v,l.api.location.longitude=D,c){const{meta:t}=c,e=function(t,e){const n=t=>t*(Math.PI/180),i=n(e.latitude-t.latitude),o=n(e.longitude-t.longitude),a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(n(t.latitude))*Math.cos(n(e.latitude))*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371*1e3}(g,t);w=Math.round(100*(e+Number.EPSILON))/100}if(g&&(p<=y||w>m)){const e=yield function(e){return t(this,void 0,void 0,(function*(){const{api:{endpoint:t,method:i,location:{latitude:o,longitude:a}},widget:{settings:{offline:s}}}=e,d=[];for(let e=0;e<s;e++){const s=new Date;s.setDate(s.getDate()+e);const c=n(t,s,{latitude:o,longitude:a,method:i}),u=(yield r(c)).data;d.push(u)}return d}))}(l);yield s(h,u,e)}}const v=yield e(h);v&&c(v,f,y,p,w).presentLarge()}))}()}catch(t){console.error(t)}}));
